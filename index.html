<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CONTENT CHEAT v71.1 (BYOK) ¬© Brata Hanggara Putra</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        html { scroll-behavior: smooth; }
        body { 
            font-family: 'Inter', sans-serif;
            background-color: #0D1120;
            background-image: radial-gradient(at 27% 37%, hsla(215, 98%, 22%, 0.2) 0px, transparent 50%), radial-gradient(at 97% 21%, hsla(212, 98%, 23%, 0.2) 0px, transparent 50%), radial-gradient(at 70% 94%, hsla(282, 98%, 23%, 0.2) 0px, transparent 50%), radial-gradient(at 10% 29%, hsla(282, 98%, 23%, 0.2) 0px, transparent 50%);
            color: #E0E0E0;
        }
        .glass-effect {
            background: rgba(17, 24, 39, 0.6);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-radius: 1.5rem; border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        .modern-input, .modern-input-group, .edit-textarea, .platform-select, .status-select {
            background-color: rgba(0, 0, 0, 0.2); border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .modern-input:focus, .edit-textarea:focus, .platform-select:focus, .status-select:focus {
            outline: none; border-color: rgba(167, 139, 250, 0.8);
            box-shadow: 0 0 0 3px rgba(167, 139, 250, 0.2);
        }
        select.modern-input option, .platform-select option, .status-select option { background: #0D1120; color: #E0E0E0; }
        .modern-btn {
            background: linear-gradient(90deg, #5F00D8, #A78BFA); border: none;
            transition: all 0.3s ease; box-shadow: 0 4px 15px 0 rgba(167, 139, 250, 0.4);
        }
        .modern-btn:hover {
            box-shadow: 0 6px 20px 0 rgba(167, 139, 250, 0.6); transform: translateY(-2px);
        }
        .modern-btn:disabled {
            background: #374151; box-shadow: none;
            cursor: not-allowed; transform: none;
        }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center;
            z-index: 50; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        .modal-content {
            background-color: rgba(13, 17, 32, 0.8);
            backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.1); padding: 1.5rem; border-radius: 1.5rem;
            width: 90%; max-width: 600px; transform: scale(0.95); transition: transform 0.3s;
            display: flex; flex-direction: column; max-height: 90vh;
        }
        .modal-overlay.visible .modal-content { transform: scale(1); }
        .modal-body { overflow-y: auto; padding-right: 1rem; }
        .spinner {
            width: 56px; height: 56px; border-radius: 50%; border: 9px solid;
            border-color: #A78BFA; border-right-color: #374151; animation: spinner-d3wgkg 1s infinite linear;
        }
        .script-loading-spinner {
            width: 48px; height: 48px; border-radius: 50%;
            display: inline-block;
            position: relative;
            border: 3px solid;
            border-color: #A78BFA #A78BFA transparent;
            animation:-rotate 1s linear infinite;
        }
        .script-loading-spinner:before {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            margin: auto;
            border: 3px solid;
            border-color: transparent #374151 #374151;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            animation: rotate-reverse 0.5s linear infinite;
        }
        @keyframes spinner-d3wgkg { to { transform: rotate(1turn); } }
        @keyframes -rotate { to { transform: rotate(360deg); } }
        @keyframes rotate-reverse { to { transform: rotate(-360deg); } }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        .shake { animation: shake 0.82s cubic-bezier(.36,.07,.19,.97) both; }
        .info-box {
            background: rgba(30, 41, 59, 0.5);
            border-left: 4px solid #a78bfa;
            padding: 1rem;
            border-radius: 0.5rem;
        }
        .favorite-btn.favorited .star-icon { color: #facc15; }
        .pustaka-entry .efektif-title, .faq-entry .efektif-title { color: #facc15; font-weight: 600;}
        .script-section .saran-shot-text { color: #60a5fa !important; font-weight: 600; }
        .hashtag {
            background-color: rgba(59, 130, 246, 0.2);
            color: #93c5fd;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .hashtag:hover { background-color: rgba(59, 130, 246, 0.4); }
        .script-edit-view { background-color: #1f2937; padding: 1rem; border-radius: 0.5rem; }
        .kerangka-konten-title {
            font-size: 1.75rem;
            font-weight: 800;
            color: #d8b4fe;
        }
        .kerangka-audio-section {
            background: linear-gradient(135deg, rgba(126, 34, 206, 0.3) 0%, rgba(29, 78, 216, 0.2) 100%);
            padding: 1rem;
            border-radius: 0.75rem;
        }
        .result-card-copy-btn {
            background-color: #4b5563;
            color: #f3f4f6;
            transition: background-color 0.2s;
        }
        .result-card-copy-btn:hover { background-color: #6b7280; }
        .result-card-script-btn {
            background: linear-gradient(90deg, #5F00D8, #A78BFA);
            color: white;
            transition: all 0.3s ease;
        }
        .result-card-script-btn:hover { box-shadow: 0 4px 15px 0 rgba(167, 139, 250, 0.4); }

        .hook-label-container { display: inline-flex; align-items: center; gap: 0.5rem; font-weight: 600; }
        .hook-label-dot { width: 8px; height: 8px; border-radius: 9999px; }
        #scrollToTopBtn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            background-color: rgba(167, 139, 250, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: opacity 0.3s, visibility 0.3s;
        }
        #scrollToTopBtn:hover {
             background-color: rgba(167, 139, 250, 1);
        }
        .tone-label {
            background-color: rgba(209, 213, 219, 0.1);
            color: #9ca3af;
            font-size: 0.75rem;
            font-weight: 500;
            padding: 2px 8px;
            border-radius: 9999px;
        }
        .audio-suggestion {
            cursor: pointer;
            text-decoration: underline;
            text-decoration-style: dotted;
            text-underline-offset: 3px;
        }
        .audio-suggestion:hover {
            color: #c4b5fd;
        }
        .file-upload-btn {
             background-color: rgba(0, 0, 0, 0.2); border: 1px solid rgba(255, 255, 255, 0.1);
             display: flex; align-items: center; justify-content: center; gap: 0.5rem;
             cursor: pointer; transition: all 0.3s ease;
        }
        .file-upload-btn:hover, .file-upload-btn.dragover {
            border-color: rgba(167, 139, 250, 0.8);
        }
        /* --- Calendar Styles --- */
        #calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        .calendar-day, .calendar-header-day {
            padding: 8px;
            text-align: center;
            border-radius: 8px;
        }
        .calendar-header-day {
            font-weight: 600;
            color: #9ca3af;
        }
        .calendar-day {
            background-color: rgba(255,255,255,0.05);
            cursor: pointer;
            transition: background-color 0.2s;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }
        .calendar-day:hover {
            background-color: rgba(255,255,255,0.1);
        }
        .calendar-day.other-month {
            opacity: 0.4;
            cursor: default;
        }
        .calendar-day.today {
            background-color: rgba(167, 139, 250, 0.3);
            border: 1px solid rgba(167, 139, 250, 0.5);
        }
        .calendar-day.selected {
            background-color: rgba(167, 139, 250, 0.6);
        }
        .scheduled-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #34d399;
            margin-top: 4px;
        }
        #calendar-details {
            background-color: rgba(0,0,0,0.2);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-top: 1rem;
            min-height: 100px;
        }
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
    </style>
</head>
<body class="antialiased">

    <div id="loginModal" class="modal-overlay">
        <div class="modal-content !max-w-md">
            <h2 class="text-2xl font-bold text-center text-white mb-2">Akses Terbatas</h2>
            <p class="text-slate-400 text-center mb-6" id="loginErrorMsg" style="display:none; color: #f87171;">Username atau Password salah!</p>
            <div class="space-y-4">
                <div>
                    <label for="username" class="block text-sm font-medium text-slate-300 mb-1">Username</label>
                    <input type="text" id="username" class="w-full rounded-lg p-3 modern-input" value="username">
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium text-slate-300 mb-1">Password</label>
                    <div class="relative">
                        <input type="password" id="password" class="w-full rounded-lg p-3 pr-10 modern-input">
                        <div id="togglePasswordVisibility" class="absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-white cursor-pointer">
                            <svg id="eye-show" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-eye-fill" viewBox="0 0 16 16"><path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"/><path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"/></svg>
                            <svg id="eye-hide" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-eye-slash-fill hidden" viewBox="0 0 16 16"><path d="m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7.029 7.029 0 0 0 2.79-.588zM5.21 3.088A7.028 7.028 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474L5.21 3.089z"/><path d="M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829l-2.83-2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12-.708.708z"/></svg>
                        </div>
                    </div>
                    <p class="text-xs text-slate-500 mt-1">Hint: Nama akun IG developer.</p>
                </div>
                <div class="flex items-center mt-4">
                    <input id="remember-me" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-purple-600 focus:ring-purple-500">
                    <label for="remember-me" class="ml-2 block text-sm text-slate-400">Ingat saya</label>
                </div>
            </div>
            <button id="loginBtn" class="w-full text-white font-bold py-3 px-6 rounded-full text-lg modern-btn mt-6">Masuk</button>
        </div>
    </div>

    <div id="apiKeyModal" class="modal-overlay">
        <div class="modal-content !max-w-lg">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-purple-400">Masukkan Kunci API Anda</h2>
                <div class="flex items-center gap-2">
                    <button id="apiKeyFaqBtn" title="FAQ about API Key" class="p-1 text-slate-400 hover:text-purple-400 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16">
                            <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
                        </svg>
                    </button>
                    <button class="close-modal-btn text-slate-400 hover:text-white text-3xl">√ó</button>
                </div>
            </div>
            <p class="text-slate-400 text-center mb-6">Tools ini membutuhkan kunci API dari Google AI Studio untuk berfungsi. Tenang, kunci Anda aman dan hanya disimpan di browser Anda.</p>
            <input type="password" id="apiKeyInput" class="w-full rounded-lg p-3 modern-input mb-4" placeholder="Masukkan Gemini API Key di sini...">
            <button id="saveApiKeyBtn" class="w-full text-white font-bold py-3 px-6 rounded-full text-lg modern-btn mb-4">Simpan & Mulai</button>
            <button id="cancelChangeApiKeyBtn" class="w-full text-slate-300 font-bold py-2 px-4 rounded-full bg-slate-600 hover:bg-slate-700 transition-colors hidden">Batal</button>
            <div class="text-center mt-4">
                <button id="howToGetApiKeyBtn" class="text-purple-400 hover:text-purple-300 text-sm">Bagaimana caranya mendapatkan Kunci API?</button>
            </div>
        </div>
    </div>
    
    <div id="tutorialModal" class="modal-overlay">
        <div class="modal-content !max-w-2xl">
            <div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold text-purple-400">Cara Mudah Mendapatkan Kunci API</h2><button class="close-modal-btn text-slate-400 hover:text-white text-3xl">√ó</button></div>
            <div class="modal-body space-y-6 text-slate-300">
                <div><h3 class="font-bold text-lg text-slate-100">Langkah 1: Buka Google AI Studio</h3><p>Klik tombol di bawah ini. Anda mungkin akan diminta login ke akun Google (Gmail) Anda.</p><a href="https://aistudio.google.com/app/apikey" target="_blank" class="inline-block mt-2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Buka Google AI Studio</a></div>
                <div><h3 class="font-bold text-lg text-slate-100">Langkah 2: Buat Kunci Baru</h3><p>Setelah halaman terbuka, klik tombol biru yang bertuliskan <strong class="text-amber-400">"Create API key in new project"</strong>.</p><img src="https://i.ibb.co/6m6Mv4T/image.png" alt="Tombol Create API Key" class="mt-2 rounded-lg border border-slate-700 w-full max-w-md" onerror="this.onerror=null;this.src='https://placehold.co/600x120/1f2937/9ca3af?text=Gagal+Memuat+Gambar'"></div>
                <div><h3 class="font-bold text-lg text-slate-100">Langkah 3: Salin Kunci Anda</h3><p>Sebuah pop-up akan muncul menampilkan kunci rahasia Anda. Klik ikon "salin" di sebelahnya.</p><img src="https://i.ibb.co/qN9qZ8j/image.png" alt="Pop-up dengan API key" class="mt-2 rounded-lg border border-slate-700 w-full max-w-md" onerror="this.onerror=null;this.src='https://placehold.co/600x200/1f2937/9ca3af?text=Gagal+Memuat+Gambar'"></div>
                <div><h3 class="font-bold text-lg text-slate-100">Selesai!</h3><p>Sekarang, kembali ke aplikasi ini dan tempel (paste) kunci yang sudah Anda salin tadi ke dalam kolom yang tersedia.</p></div>
            </div>
        </div>
    </div>
    
    <div id="hookExplanationModal" class="modal-overlay">
        <div class="modal-content !max-w-lg">
            <div class="flex justify-between items-center mb-4"><h2 id="explanation-title" class="text-2xl font-bold text-purple-400"></h2><button class="close-modal-btn text-slate-400 hover:text-white text-3xl">√ó</button></div>
            <div id="explanation-body" class="modal-body text-slate-300"></div>
        </div>
    </div>

    <div id="pustakaHookModal" class="modal-overlay">
        <div class="modal-content !max-w-2xl">
            <div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold text-purple-400">üìö Pustaka Strategi Hook</h2><button class="close-modal-btn text-slate-400 hover:text-white text-3xl">√ó</button></div>
            <div id="pustaka-body" class="modal-body space-y-6 text-slate-300"></div>
        </div>
    </div>

    <div id="faqModal" class="modal-overlay">
        <div class="modal-content !max-w-2xl">
            <div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold text-purple-400">‚ÑπÔ∏è Tanya Jawab (FAQ)</h2><button class="close-modal-btn text-slate-400 hover:text-white text-3xl">√ó</button></div>
            <div id="faq-body" class="modal-body space-y-6 text-slate-300">
                <div class="faq-entry">
                    <h3 class="font-bold text-lg text-slate-100">Apa keunggulan aplikasi ini?</h3>
                    <p class="mt-1">Content Cheat dirancang untuk menjadi asisten konten lengkap Anda. Keunggulannya adalah:</p>
                    <ul class="list-disc list-inside mt-2 text-slate-400">
                        <li><strong>Cepat & Efisien:</strong> Hasilkan puluhan ide konten unik dalam hitungan detik.</li>
                        <li><strong>Kerangka Lengkap:</strong> Tidak hanya ide, dapatkan juga kerangka skrip lengkap mulai dari audio, visual, narasi, hingga CTA.</li>
                        <li><strong>Kustomisasi Penuh:</strong> Edit setiap bagian dari kerangka konten sesuai kebutuhan brand Anda.</li>
                        <li><strong>Fitur Favorit:</strong> Simpan ide-ide terbaik Anda agar tidak hilang dan mudah diakses kembali.</li>
                        <li><strong>Privasi Terjamin:</strong> Kunci API Anda 100% aman dan hanya disimpan di browser Anda.</li>
                    </ul>
                </div>
                <div class="faq-entry">
                    <h3 class="font-bold text-lg text-slate-100">Apa itu API Key?</h3>
                    <p class="mt-1">API Key adalah kode unik, mirip seperti password, yang memberikan Anda akses ke layanan AI dari Google. Anda membutuhkannya agar aplikasi ini bisa berfungsi.</p>
                </div>
                <div class="faq-entry">
                    <h3 class="font-bold text-lg text-slate-100">Mengapa saya harus memasukkan API Key sendiri?</h3>
                    <p class="mt-1">Aplikasi ini menggunakan model "Bring Your Own Key" (Bawa Kunci Sendiri). Artinya, Anda menggunakan kunci pribadi Anda untuk mengakses AI, sehingga developer tidak perlu menarik biaya langganan untuk menutupi biaya server. Anda punya kontrol penuh.</p>
                </div>
                <div class="faq-entry">
                    <h3 class="font-bold text-lg text-slate-100">Apakah API Key saya aman?</h3>
                    <p class="mt-1"><strong>Sangat aman.</strong> Kunci API Anda hanya disimpan di browser Anda (<code class="text-xs bg-slate-700 px-1 rounded">localStorage</code>) dan tidak pernah dikirim ke server kami. Kunci tersebut hanya digunakan untuk berkomunikasi langsung antara browser Anda dan Google AI.</p>
                </div>
                <div class="faq-entry">
                    <h3 class="font-bold text-lg text-slate-100">Kapan kuota generate direset?</h3>
                    <p class="mt-1">Kuota generate gratis Anda direset setiap hari pada pukul <strong class="efektif-title">00:00 (tengah malam)</strong> sesuai waktu lokal perangkat Anda.</p>
                </div>
                 <div class="faq-entry">
                    <h3 class="font-bold text-lg text-slate-100">Mengapa ada kuota generate?</h3>
                    <p class="mt-1">Kuota harian adalah fitur keamanan untuk melindungi Anda dari penggunaan berlebih yang tidak disengaja, yang mungkin bisa menimbulkan biaya dari Google. Ini membantu memastikan penggunaan API Key Anda tetap dalam batas wajar setiap harinya.</p>
                </div>
            </div>
        </div>
    </div>

    <div id="apiKeyFaqModal" class="modal-overlay">
        <div class="modal-content !max-w-2xl">
            <div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold text-purple-400">‚ùì Tanya Jawab API Key</h2><button class="close-modal-btn text-slate-400 hover:text-white text-3xl">√ó</button></div>
            <div class="modal-body space-y-6 text-slate-300">
                <div class="faq-entry">
                    <h3 class="font-bold text-lg text-slate-100">Apa itu Kunci API / API Key?</h3>
                    <p class="mt-1">API Key adalah kode unik, mirip seperti password, yang memberikan Anda akses ke layanan AI dari Google. Anda membutuhkannya agar aplikasi ini bisa berfungsi.</p>
                </div>
                <div class="faq-entry">
                    <h3 class="font-bold text-lg text-slate-100">Apakah Aman?</h3>
                    <p class="mt-1"><strong>Sangat aman.</strong> Kunci API Anda hanya disimpan di browser Anda dan tidak pernah dikirim ke server kami. Kunci tersebut hanya digunakan untuk berkomunikasi langsung antara browser Anda dan Google AI.</p>
                </div>
                <div class="faq-entry">
                    <h3 class="font-bold text-lg text-slate-100">Bagaimana cara mendapatkan Kunci API?</h3>
                    <p class="mt-1">Anda bisa mengikuti tutorial lengkap dengan menekan tombol "Bagaimana caranya mendapatkan Kunci API?" di halaman sebelumnya atau <button id="openTutorialFromFaq" class="text-purple-400 hover:underline">klik di sini</button>.</p>
                </div>
            </div>
        </div>
    </div>
    
    <div id="scriptModal" class="modal-overlay">
        <div class="modal-content !max-w-2xl">
            <div class="flex justify-between items-center mb-4"><h2 class="kerangka-konten-title">‚ú® Kerangka Konten AI</h2><button class="close-modal-btn text-slate-400 hover:text-white text-3xl">√ó</button></div>
            <div id="script-result-container" class="modal-body space-y-5"></div>
            <div class="mt-4 pt-4 border-t border-slate-700/50 flex flex-col gap-3">
                <div id="script-buttons" class="grid grid-cols-2 sm:grid-cols-4 gap-3" style="display:none;">
                    <button id="schedule-btn" class="text-white font-bold py-2 px-4 rounded-lg bg-teal-600 hover:bg-teal-700 transition-colors">Jadwalkan</button>
                    <button id="copy-all-script-btn" class="text-white font-bold py-2 px-4 rounded-lg bg-blue-600 hover:bg-blue-700 transition-colors">Salin Teks</button>
                    <button id="copy-gdocs-btn" class="text-white font-bold py-2 px-4 rounded-lg bg-sky-600 hover:bg-sky-700 transition-colors">Export Docs</button>
                    <button id="download-doc-btn" class="text-white font-bold py-2 px-4 rounded-lg bg-green-600 hover:bg-green-700 transition-colors">Download</button>
                </div>
                <p id="script-disclaimer" class="text-xs text-slate-500 text-center italic" style="display:none;">*bisa disesuaikan sendiri menurut kebutuhan Anda</p>
            </div>
        </div>
    </div>

    <div id="hashtagModal" class="modal-overlay">
        <div class="modal-content !max-w-md">
            <div class="flex justify-between items-center mb-4"><h2 id="hashtag-title" class="text-xl font-bold text-white"></h2><button class="close-modal-btn text-slate-400 hover:text-white text-3xl">√ó</button></div>
            <div class="text-slate-300 mb-4">Lihat popularitas dan konten terkait untuk tag ini di platform berikut:</div>
            <div class="space-y-3">
                <a id="instagram-link" href="#" target="_blank" class="flex items-center justify-center gap-3 w-full text-white font-bold py-3 px-4 rounded-lg bg-gradient-to-r from-pink-500 via-red-500 to-yellow-500 hover:opacity-90 transition-opacity">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-instagram" viewBox="0 0 16 16"><path d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8s.01 2.444.048 3.297c.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926 0 0 0-.923-1.417A3.911 3.911 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 8 0zm0 1.442a6.556 6.556 0 0 1 3.25.045c.78.034 1.164.163 1.405.27.29.13.518.31.728.518.21.21.388.438.518.728.107.24.237.625.27 1.405.046.86.054 1.134.054 3.25s-.008 2.39-.054 3.25c-.033.78-.163 1.165-.27 1.405a2.47 2.47 0 0 1-.518.728c-.21.21-.438.388-.728.518-.24.107-.625.237-1.405.27-.86.046-1.134.054-3.25.054s-2.39-.008-3.25-.054c-.78-.033-1.165-.163-1.405-.27a2.47 2.47 0 0 1-.728-.518c-.21-.21-.388-.438-.518-.728-.107-.24-.237-.625-.27-1.405-.046-.86-.054-1.134-.054-3.25s.008-2.39.054-3.25c.033-.78.163-1.165.27-1.405a2.47 2.47 0 0 1 .518-.728c.21-.21.438-.388.728-.518.24-.107.625.237 1.405-.27.86-.046 1.134.054 3.25-.054zM8 4.868a3.132 3.132 0 1 0 0 6.264 3.132 3.132 0 0 0 0-6.264zm0 1.442a1.69 1.69 0 1 1 0 3.38 1.69 1.69 0 0 1 0-3.38zm4.39-1.442a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92z"/></svg>
                    Lihat di Instagram
                </a>
                <a id="tiktok-link" href="#" target="_blank" class="flex items-center justify-center gap-3 w-full text-white font-bold py-3 px-4 rounded-lg bg-black border border-slate-600 hover:bg-slate-800 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M9 0h1.98c.144.715.54 1.617 1.235 2.512C12.895 3.389 13.797 4 15 4v2c-1.753 0-3.07-.814-4-1.829V11a5 5 0 1 1-5-5v2a3 3 0 1 0 3 3V0Z"/></svg>
                    Lihat di TikTok
                </a>
                <a id="facebook-link" href="#" target="_blank" class="flex items-center justify-center gap-3 w-full text-white font-bold py-3 px-4 rounded-lg bg-gradient-to-r from-blue-600 to-blue-800 hover:opacity-90 transition-opacity">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z"/></svg>
                    Lihat di Facebook
                </a>
            </div>
        </div>
    </div>
    
    <div id="audioSearchModal" class="modal-overlay">
        <div class="modal-content !max-w-md">
            <div class="flex justify-between items-center mb-4"><h2 id="audio-title" class="text-xl font-bold text-white"></h2><button class="close-modal-btn text-slate-400 hover:text-white text-3xl">√ó</button></div>
            <div class="text-slate-300 mb-4">Dengarkan atau cari audio ini di platform berikut:</div>
            <div class="space-y-3">
                <a id="youtube-audio-link" href="#" target="_blank" class="flex items-center justify-center gap-3 w-full text-white font-bold py-3 px-4 rounded-lg bg-red-600 hover:bg-red-700 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16" class="flex-shrink-0"><path d="M8.051 1.999h.089c.822.003 4.987.033 6.11.335a2.01 2.01 0 0 1 1.415 1.42c.101.38.172.883.22 1.402l.01.104.022.26.008.104c.065.914.073 1.77.074 1.957v.075c-.001.194-.01 1.108-.082 2.06l-.008.105-.022.26-.01.104c-.048.519-.119 1.023-.22 1.402a2.007 2.007 0 0 1-1.415 1.42c-1.16.312-5.569.334-6.18.335h-.142c-.309 0-1.587-.006-2.927-.052l-.17-.006-.087-.004-.171-.007-.086-.003c-1.702-.074-2.973-.17-3.294-.265a2.007 2.007 0 0 1-1.416-1.42c-.101-.38-.172-.883-.22-1.402l-.01-.104-.022-.26-.008-.104c-.065-.914-.073-1.77-.074-1.957v-.075c.001-.194.01-1.108.082-2.06l.008-.105.022-.26.01-.104c.048-.519.119-1.023.22-1.402a2.007 2.007 0 0 1 1.415-1.42c.418-.105 1.912-.19 3.455-.254l.262-.007.126-.003h.09c1.27.006 2.404.01 3.294.026h.093zM6.425 7.648V10.5l3.295-1.426L6.425 7.648z"></path></svg>
                    Dengarkan di YouTube
                </a>
                 <a id="spotify-audio-link" href="#" target="_blank" class="flex items-center justify-center gap-3 w-full text-white font-bold py-3 px-4 rounded-lg bg-green-500 hover:bg-green-600 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zm3.669 11.538a.498.498 0 0 1-.686.165c-1.879-1.147-4.243-1.407-7.028-.77a.499.499 0 0 1-.222-.973c3.048-.696 5.662-.397 7.77.892a.5.5 0 0 1 .166.686zm.979-2.178a.624.624 0 0 1-.858.205c-2.15-1.321-5.428-1.704-7.972-.932a.625.625 0 0 1-.362-1.194c2.905-.881 6.517-.454 8.986 1.063a.624.624 0 0 1 .206.858zm.084-2.268C10.154 5.56 5.9 5.419 3.438 6.166a.748.748 0 1 1-.434-1.432c2.825-.857 7.523-.692 10.492 1.07a.747.747 0 1 1-.764 1.288z"/></svg>
                    Cari di Spotify
                </a>
            </div>
        </div>
    </div>

    <!-- Calendar Modal -->
    <div id="calendarModal" class="modal-overlay">
        <div class="modal-content !max-w-4xl">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-purple-400">üóìÔ∏è Kalender Konten</h2>
                <button class="close-modal-btn text-slate-400 hover:text-white text-3xl">√ó</button>
            </div>
            <div class="modal-body">
                <div class="flex justify-between items-center mb-4">
                    <button id="prev-month-btn" class="p-2 rounded-full hover:bg-slate-700">&lt;</button>
                    <h3 id="month-year-header" class="text-xl font-bold"></h3>
                    <button id="next-month-btn" class="p-2 rounded-full hover:bg-slate-700">&gt;</button>
                </div>
                <div id="calendar-grid"></div>
                <div id="calendar-details" class="mt-4">
                    <p class="text-slate-400">Pilih tanggal untuk melihat jadwal konten.</p>
                </div>
                 <div id="calendar-actions" class="mt-4 pt-4 border-t border-slate-700/50" style="display: none;">
                    <button id="save-schedule-btn" class="w-full text-white font-bold py-2 px-4 rounded-lg bg-teal-600 hover:bg-teal-700">Simpan Jadwal untuk Tanggal Terpilih</button>
                </div>
            </div>
        </div>
    </div>


    <div id="app-container" class="container mx-auto max-w-4xl p-4 md:p-8" style="display: none;">
        <header class="text-center mb-8 relative">
            <h1 class="text-4xl md:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400">CONTENT CHEAT</h1>
            <p class="text-slate-500 mt-1 text-sm font-semibold">v71.1</p>
            <p class="text-slate-400 mt-2 text-lg">Buat Ide Kontenmu dengan Sekali Klik</p>
            <a href="https://www.instagram.com/brata_putra/" target="_blank" class="text-purple-300 hover:text-purple-200 transition-colors mt-2 inline-block">¬© Brata Hanggara Putra</a>
            <p class="text-red-500 font-bold mt-2 text-sm tracking-wider">DILARANG MENJUAL KEMBALI TOOLS INI TANPA SEIZIN PENGEMBANG!</p>
            
            <!-- Perubahan 1: Posisi Ikon Menu untuk Mobile -->
            <div class="mt-6 flex justify-center items-center gap-2 md:absolute md:top-0 md:right-0 md:mt-0">
                <button id="calendar-view-btn" title="Kalender Konten" class="p-2 text-slate-400 hover:text-purple-400 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-calendar-week-fill" viewBox="0 0 16 16"><path d="M4 .5a.5.5 0 0 0-1 0V1H2a2 2 0 0 0-2 2v1h16V3a2 2 0 0 0-2-2h-1V.5a.5.5 0 0 0-1 0V1H4V.5zM16 14V5H0v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2zM9.5 7h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5zm3 0h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5zM2 10.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3.5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5z"/></svg></button>
                <button id="pustaka-hook-btn" title="Pustaka Hook" class="p-2 text-slate-400 hover:text-purple-400 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"><path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/></svg></button>
                <button id="faq-btn" title="FAQ" class="p-2 text-slate-400 hover:text-purple-400 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-question-circle-fill" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.496 6.033h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286a.237.237 0 0 0 .241.247zm2.325 6.443c.61 0 1.029-.394 1.029-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94 0 .533.425.927 1.01.927z"/></svg></button>
            </div>

            <div class="mt-6 info-box"><p class="text-slate-300">Sisa kuota generate hari ini: <strong id="quota-counter" class="text-xl text-green-400">200</strong></p><p class="text-xs text-slate-500 mt-1">Kuota direset setiap hari. <button id="changeApiKey" class="text-purple-400 hover:underline">Ganti API Key</button></p></div>
        </header>

        <div class="p-8 glass-effect">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-6">
                 <div><label for="topic" class="block text-sm font-medium text-slate-300 mb-2">1. Masukkan Produk / Jasa Anda <span class="text-red-400">(Wajib)</span></label><input type="text" id="topic" class="w-full rounded-lg p-3 modern-input" placeholder="Cth: Tripod, Serum Wajah"></div>
                 <div><label for="audience" class="block text-sm font-medium text-slate-300 mb-2">2. Siapa Target Audiens Anda? <span class="text-slate-400">(Opsional)</span></label><input type="text" id="audience" class="w-full rounded-lg p-3 modern-input" placeholder="Cth: Konten Kreator, Pebisnis Online"></div>
                
                 <div>
                    <label for="details" class="block text-sm font-medium text-slate-300 mb-2">3. Detail Tambahan (Opsional)</label>
                    <input type="text" id="details" class="w-full rounded-lg p-3 modern-input" placeholder="Cth: Merk, Harga, Manfaat Utama">
                </div>
                 <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">4. Unggah Referensi Visual (Opsional)</label>
                    <div id="image-upload-container">
                        <label for="image-upload" class="file-upload-btn w-full rounded-lg p-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cloud-arrow-up-fill" viewBox="0 0 16 16"><path d="M8 2a5.53 5.53 0 0 0-3.594 1.342c-.766.66-1.321 1.52-1.464 2.383C1.266 6.095 0 7.555 0 9.318 0 11.366 1.708 13 3.781 13h8.906C14.502 13 16 11.57 16 9.773c0-1.636-1.242-2.969-2.834-3.194C12.923 3.999 10.69 2 8 2zm2.354 5.146a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2a.5.5 0 0 1 .708 0l2 2z"/></svg>
                            <span>Pilih Gambar...</span>
                        </label>
                        <input type="file" id="image-upload" class="hidden" accept="image/png, image/jpeg, image/webp">
                    </div>
                    <div id="image-preview-container" class="mt-2 hidden relative w-32 h-32">
                        <img id="image-preview" class="rounded-lg w-full h-full object-cover">
                        <button id="remove-image-btn" class="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center p-1 text-lg leading-none">√ó</button>
                    </div>
                </div>

                 <div>
                    <label for="hook-type" class="block text-sm font-medium text-slate-300 mb-2">5. Pilih Jenis Hasil (Opsional)</label>
                    <select id="hook-type" class="w-full rounded-lg p-3 modern-input">
                        <option value="semua">üî• Tampilkan Semua (Direkomendasikan)</option><option value="Narasi">Narasi</option><option value="Pertanyaan">Pertanyaan</option><option value="Sebelum & Sesudah">Sebelum & Sesudah</option><option value="Social Proof">Social Proof</option><option value="Janji & Manfaat">Janji & Manfaat</option><option value="How-To">How-To</option><option value="Kontroversial">Kontroversial</option><option value="Negatif">Negatif</option><option value="FOMO">FOMO</option><option value="Penasaran">Penasaran</option><option value="Statistik">Statistik</option><option value="Kutipan">Kutipan</option><option value="Panggilan Langsung">Panggilan Langsung</option>
                    </select>
                </div>
                <div>
                    <label for="tone-of-voice" class="block text-sm font-medium text-slate-300 mb-2">6. Pilih Gaya Bahasa (Opsional)</label>
                    <select id="tone-of-voice" class="w-full rounded-lg p-3 modern-input">
                        <option value="semua">‚ú® Tampilkan Semua (Direkomendasikan)</option>
                        <option value="Profesional">Profesional</option>
                        <option value="Lucu/Humoris">Lucu/Humoris</option>
                        <option value="Inspiratif">Inspiratif</option>
                        <option value="Storytelling">Storytelling</option>
                        <option value="Santai">Santai</option>
                    </select>
                </div>
                <div class="col-span-1 md:col-span-2">
                    <label for="hook-count" class="block text-sm font-medium text-slate-300 mb-2">7. Jumlah Hasil (Opsional)</label>
                    <select id="hook-count" class="w-full rounded-lg p-3 modern-input"><option value="5">5 Hasil</option><option value="10">10 Hasil</option><option value="20">20 Hasil</option></select>
                </div>
            </div>
            <div class="mt-8"><button id="generateBtn" class="w-full flex items-center justify-center gap-3 text-white font-bold py-4 px-6 rounded-full text-lg modern-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path></svg>Generate Konten!</button></div>
        </div>
        
        <div id="results-container" class="mt-12">
            <div id="results-header" class="flex justify-between items-center mb-4" style="display: none;">
                <h2 class="text-2xl font-bold text-slate-200">Hasil Ide Konten</h2>
                <div class="flex items-center gap-4">
                    <button id="view-history-btn" class="bg-sky-500/10 text-sky-300 font-bold py-2 px-4 rounded-lg flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/><path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/></svg>
                        Riwayat
                    </button>
                    <button id="view-favorites-btn" class="bg-yellow-500/10 text-yellow-300 font-bold py-2 px-4 rounded-lg flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16"><path d="M3.612 15.443c-.343.197-.732.026-.976-.316C2.384 14.79 2.421 14.34 2.658 14.1l.099-.101 2.56-2.528-3.797-2.61L.064 6.25c-.26-.193-.398-.5-.358-.814.04-.314.25-.583.543-.695L4.82 3.32 6.59.165c.195-.33.542-.515.91-.492.368.023.68.26.83.585l1.78 3.155 4.542 1.32c.303.088.513.368.553.68.04.313-.098.62-.358.814l-2.823 2.062 1.005 4.423c.06.264-.028.54-.25.728-.222.188-.533.243-.815.145L8 13.34l-3.267 2.007-.093.057-.003.002z"/></svg>
                        Favorit (<span id="favorite-count">0</span>)
                    </button>
                </div>
            </div>
            <div id="results-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </div>
    </div>
    
    <button id="scrollToTopBtn">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-arrow-up-short" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M8 12a.5.5 0 0 0 .5-.5V5.707l2.146 2.147a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7.5 5.707V11.5a.5.5 0 0 0 .5.5z"/>
        </svg>
    </button>
    
    <div id="notification" class="fixed bottom-5 right-5 bg-green-600 text-white py-3 px-5 rounded-lg shadow-lg opacity-0 transform translate-y-10 transition-all duration-500 z-50"></div>

    <script type="module">
        // --- GLOBAL STATE ---
        let userAPIKey = null;
        let lastGeneratedHooks = [];
        let favorites = [];
        let history = [];
        let scheduledContent = {};
        let currentView = 'results'; // can be 'results', 'favorites', or 'history'
        let currentScriptData = null;
        let uploadedImageBase64 = null;
        let calendarDate = new Date();
        let selectedDateForScheduling = null;
        let itemToMove = null; // To track item being moved in calendar


        const hookCategoryStyles = {
            'Default': 'bg-gray-500/20 text-gray-300',
            'Narasi': 'bg-purple-500/20 text-purple-300',
            'Pertanyaan': 'bg-sky-500/20 text-sky-300',
            'Sebelum & Sesudah': 'bg-teal-500/20 text-teal-300',
            'Social Proof': 'bg-blue-500/20 text-blue-300',
            'Janji & Manfaat': 'bg-amber-500/20 text-amber-300',
            'How-To': 'bg-green-500/20 text-green-300',
            'Kontroversial': 'bg-orange-500/20 text-orange-300',
            'Negatif': 'bg-rose-500/20 text-rose-300',
            'FOMO': 'bg-red-500/20 text-red-300',
            'Penasaran': 'bg-indigo-500/20 text-indigo-300',
            'Statistik': 'bg-pink-500/20 text-pink-300',
            'Kutipan': 'bg-lime-500/20 text-lime-300',
            'Panggilan Langsung': 'bg-cyan-500/20 text-cyan-300',
        };

        const hookExplanations = {
            "Narasi": { 
                desc: "Membangun hubungan emosional dengan membagikan pengalaman pribadi (struggle & success). Sangat relateable.",
                efektif: "Personal Branding, Produk Solutif"
            },
            "Pertanyaan": {
                desc: "Memicu interaksi dan membuat audiens merefleksikan masalah mereka sendiri. Mendorong komentar.",
                efektif: "Semua Kategori"
            },
            "Sebelum & Sesudah": {
                desc: "Menunjukkan transformasi nyata untuk membuktikan efektivitas produk/jasa. Sangat visual dan meyakinkan.",
                efektif: "Produk Fisik, Jasa Skill, Kecantikan"
            },
            "Social Proof": {
                desc: "Menggunakan bukti (testimoni, angka penjualan, ulasan) bahwa banyak orang lain telah percaya pada produk/jasa Anda.",
                efektif: "Semua Kategori, terutama E-commerce"
            },
            "Janji & Manfaat": {
                desc: "Memberikan janji nilai yang jelas dan langsung di awal video. Membuat audiens penasaran dengan hasilnya.",
                efektif: "Jasa, Edukasi, Produk Solutif"
            },
            "How-To": {
                desc: "Menawarkan tutorial atau cara melakukan sesuatu yang diinginkan oleh target audiens.",
                efektif: "Konten Edukasi, DIY, Skill-based"
            },
            "Kontroversial": {
                desc: "Menyatakan opini yang tidak umum atau berlawanan dengan kepercayaan populer untuk memancing perdebatan dan engagement.",
                efektif: "Personal Branding, Konten Opini"
            },
            "Negatif": {
                desc: "Menyoroti kesalahan umum atau hal-hal yang harus dihindari oleh audiens. Bermain dengan psikologi 'loss aversion'.",
                efektif: "Konten Edukasi, Nasihat Keuangan/Kesehatan"
            },
            "FOMO": {
                desc: "Fear Of Missing Out. Menciptakan urgensi atau kelangkaan, membuat audiens merasa harus bertindak sekarang.",
                efektif: "Promo Terbatas, Produk Eksklusif, Event"
            },
            "Penasaran": {
                desc: "Menciptakan 'kesenjangan informasi' yang membuat audiens harus menonton sampai akhir untuk tahu jawabannya.",
                efektif: "Storytelling, Product Teaser, Vlog"
            },
            "Statistik": {
                desc: "Menggunakan data, angka, atau fakta mengejutkan untuk membangun kredibilitas dan menarik perhatian.",
                efektif: "Konten Informatif, Berita, Presentasi Bisnis"
            },
            "Kutipan": {
                desc: "Memulai dengan kutipan yang kuat, relevan, atau inspiratif dari tokoh terkenal atau sumber terpercaya.",
                efektif: "Konten Motivasi, Self-development"
            },
            "Panggilan Langsung": {
                desc: "Secara langsung memanggil atau menyebut target audiens spesifik untuk membuat mereka merasa 'terpanggil'.",
                efektif: "Niche Market, Konten Komunitas"
            }
        };
        
        // --- UI UTILITIES ---
        function showNotification(message, isError = false, duration = 3000) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `fixed bottom-5 right-5 text-white py-3 px-5 rounded-lg shadow-lg opacity-100 transform translate-y-0 transition-all duration-500 z-50 ${isError ? 'bg-red-600' : 'bg-green-600'}`;
            setTimeout(() => { 
                notification.classList.replace('opacity-100', 'opacity-0'); 
                notification.classList.replace('translate-y-0', 'translate-y-10');
            }, duration);
        }

        function fallbackCopy(text, customMessage = 'Berhasil disalin ke clipboard!') {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                showNotification(customMessage);
            } catch (err) {
                showNotification('Gagal menyalin teks.', true);
            }
            document.body.removeChild(textarea);
        }
        
        // --- API CALLS ---
        async function callGeminiAPI(prompt, apiKey, imageBase64 = null, mimeType = null) {
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;
            
            let contents = [{
                parts: [{ text: prompt }]
            }];

            if (imageBase64 && mimeType) {
                contents[0].parts.push({
                    inline_data: {
                        mime_type: mimeType,
                        data: imageBase64 
                    }
                });
            }

            const maxRetries = 3;
            let delay = 1000; // Start with 1 second delay

            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ contents })
                    });

                    if (response.ok) {
                        return await response.json(); // Success, return the result
                    }

                    const errorBody = await response.json();
                    console.error(`API Error (Attempt ${i + 1}):`, errorBody);

                    // --- Handle specific, non-retriable errors ---
                    if (response.status === 400 && errorBody.error?.message.includes("API key not valid")) {
                        throw new Error("API Key tidak valid. Mohon periksa kembali atau ganti dengan yang baru.");
                    }
                    if (response.status === 429) {
                        throw new Error("API_QUOTA_EXCEEDED");
                    }

                    // --- Handle retriable server errors ---
                    if (response.status >= 500) { 
                        if (i < maxRetries - 1) {
                            console.log(`Server error. Retrying in ${delay / 1000}s...`);
                            await new Promise(resolve => setTimeout(resolve, delay));
                            delay *= 2; 
                            continue; 
                        } else {
                            throw new Error(`Sistem AI sedang sibuk (Status: ${response.status}). Coba lagi nanti.`);
                        }
                    }
                    
                    throw new Error(errorBody.error?.message || `Terjadi kesalahan (Status: ${response.status}).`);

                } catch (error) {
                    console.error(`Fetch/Logic Error (Attempt ${i + 1}):`, error);
                     if (error.message === "API Key tidak valid." || error.message === "API_QUOTA_EXCEEDED") {
                         throw error; 
                     }
                    if (i < maxRetries - 1) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2;
                    } else {
                        if (error instanceof TypeError) {
                             throw new Error("Gagal terhubung ke server AI. Periksa koneksi internet Anda atau coba nonaktifkan ekstensi browser (seperti AdBlock).");
                        }
                        throw new Error("Gagal terhubung ke sistem AI setelah beberapa kali mencoba. Periksa koneksi internet Anda atau coba lagi nanti.");
                    }
                }
            }
        }


        async function generateAIHooks(topic, audience, details, hookType, hookCount, tone, apiKey) {
             const allCategories = Object.keys(hookExplanations).join(", ");
             const allTones = "Profesional, Lucu/Humoris, Inspiratif, Storytelling, Santai";
             const prompt = `Anda adalah seorang content strategist AI. Buat ${hookCount} hook video pendek untuk TikTok/Reels.
ATURAN:
1. **WAJIB SINGKAT!** (di bawah 12 kata).
2. Gunakan bahasa Indonesia sehari-hari.
3. WAJIB relevan dengan Topik.
4. Pastikan kategori sesuai jenis hook yang diminta. Jika jenis hook "semua", buat variasi dari kategori berikut: ${allCategories}.
5. Pastikan gaya bahasa (tone) sesuai yang diminta. Jika gaya bahasa "semua", buat variasi dari gaya bahasa berikut: ${allTones}.
DATA:
- Topik: "${topic}"
- Audiens: "${audience || 'Umum'}"
- Detail Tambahan: "${details || 'Tidak ada'}"
- Jenis Hook: "${hookType}"
- Gaya Bahasa: "${tone}"

Respon HARUS berupa string array JSON valid tanpa karakter markdown (seperti \`\`\`json). 
Contoh format: [{"hook": "Teks hook pertama...", "category": "Narasi", "tone": "Storytelling"}, {"hook": "Teks hook kedua...", "category": "Pertanyaan", "tone": "Santai"}]`;
             const result = await callGeminiAPI(prompt, apiKey);
             if (result.candidates?.[0]?.content?.parts?.[0]) {
                 const rawText = result.candidates[0].content.parts[0].text;
                 const cleanedText = rawText.replace(/```json/g, '').replace(/```/g, '').trim();
                 try {
                     const parsed = JSON.parse(cleanedText);
                     addToHistory(parsed);
                     return parsed;
                 } catch (e) {
                     console.error("JSON Parsing Error. Raw text:", cleanedText);
                     throw new Error("Gagal memproses respons dari AI. Coba generate lagi.");
                 }
             }
             throw new Error("Struktur respons AI tidak terduga.");
        }

        async function generateAIScript(hookText, apiKey, imageBase64 = null) {
            let prompt = `Anda adalah seorang AI Scriptwriter profesional. Berdasarkan hook dan data berikut, buatlah kerangka konten video pendek (TikTok/Reels) yang lengkap, terstruktur, dan gunakan Bahasa Indonesia. Izinkan penggunaan istilah teknis umum (seperti 'close-up') tetapi mayoritas harus dalam Bahasa Indonesia.`;
            
            const mimeType = 'image/jpeg';

            prompt += `\n\nHook: "${hookText}"
Produk/Jasa: "${document.getElementById('topic').value}"

ATURAN WAJIB:
1.  **Struktur Output**: Respons HARUS dalam format JSON yang valid dan HANYA JSON. Pastikan JSON tidak terpotong dan valid sepenuhnya.
2.  **Konten JSON**: JSON harus memiliki kunci- kunci berikut: "saran_audio", "hook_scene", "masalah", "solusi", "cta", "caption", dan "hashtags".
3.  **Detail Setiap Bagian**: Untuk "hook_scene", "masalah", "solusi", dan "cta", masing-masing harus berupa objek yang berisi: "durasi", "estimasi", "visual", "narasi", "saran_shot", dan WAJIB ada "lokasi", "properti", "pencahayaan", dan "mood".
4.  **KONSISTENSI SCENE**: Pastikan "lokasi", "properti", "pencahayaan", dan "mood" untuk setiap scene saling berhubungan dan menciptakan alur cerita yang logis. Jika tidak ada perubahan signifikan, pertahankan lokasi yang sama di beberapa scene awal (contoh: hook dan masalah terjadi di lokasi yang sama).
5.  **Saran Audio**: "saran_audio" HARUS berupa array berisi objek, dengan setiap objek memiliki kunci "title" dan "artist". Contoh: [{"title": "Espresso", "artist": "Sabrina Carpenter"}]. Berikan 2-3 saran.
6.  **Konten Lain**: "caption" harus string. "hashtags" harus array string HANYA BERISI KATA TANPA SIMBOL #.
7.  **Bahasa**: Gunakan bahasa Indonesia yang kasual dan menarik.
8.  **Larangan**: **JANGAN** sertakan simbol hashtag (#) di dalam string "caption". Buat caption yang enak dibaca, boleh menggunakan line break (\\n) untuk paragraf.

Contoh struktur JSON yang diharapkan:
{
  "saran_audio": [{"title": "Espresso", "artist": "Sabrina Carpenter"}, {"title": "LUNCH", "artist": "Billie Eilish"}],
  "hook_scene": { "durasi": "0-3", "estimasi": 3, "lokasi": "Kamar tidur yang berantakan", "properti": "Pakaian di lantai, buku berserakan", "pencahayaan": "Cahaya pagi dari jendela", "mood": "Merasa kewalahan, pusing", "visual": "Video goyang sebelum pakai tripod, lalu stabil setelahnya.", "narasi": "Video stabil? Tripod ini jawabannya!", "saran_shot": "Side-by-side comparison" },
  "masalah": { "durasi": "3-8", "estimasi": 5, "lokasi": "Kamar tidur yang berantakan", "properti": "Handphone dipegang dengan tangan yang gemetar", "pencahayaan": "Sama seperti scene hook", "mood": "Frustrasi, hampir menyerah", "visual": "Close-up video yang goyang, memperlihatkan kesulitan merekam.", "narasi": "Capek video goyang terus?\\nBikin pusing yang nonton!", "saran_shot": "Close-up" },
  "solusi": { "durasi": "8-15", "estimasi": 7, "lokasi": "Studio mini di sudut kamar yang sudah rapi", "properti": "Tripod, produk, ring light kecil", "pencahayaan": "Terang dan fokus ke produk", "mood": "Percaya diri, senang, puas", "visual": "Demonstrasi penggunaan tripod dalam berbagai situasi.", "narasi": "Nih, kenalan sama tripod andalan! Ringan, kuat, fleksibel!", "saran_shot": "360 degree view" },
  "cta": { "durasi": "15-18", "estimasi": 3, "lokasi": "Studio mini di sudut kamar yang sudah rapi", "properti": "Tampilan produk di tripod dengan jelas", "pencahayaan": "Pencahayaan terbaik (golden hour/studio)", "mood": "Antusias, mengajak", "visual": "Tampilan layar dengan teks 'Beli Sekarang' dan link ke toko.", "narasi": "Langsung checkout sekarang! Stok terbatas!", "saran_shot": "Extreme close-up produk" },
  "caption": "Gak ada lagi video goyang! Tripod ini solusi konten stabilmu.\\nBikin konten makin profesional dan menarik!",
  "hashtags": ["tripod", "videostabil", "kontenkreator"]
}`;
            
            const result = await callGeminiAPI(prompt, apiKey, imageBase64, mimeType);
            if (result.candidates?.[0]?.content?.parts?.[0]) {
                const rawText = result.candidates[0].content.parts[0].text;
                // --- ROBUST JSON CLEANING ---
                const jsonMatch = rawText.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    try {
                        return JSON.parse(jsonMatch[0]);
                    } catch (e) {
                        console.error("JSON Parsing Error after robust cleaning. Cleaned text:", jsonMatch[0], e);
                        throw new Error(`Gagal memproses kerangka: Respons AI tidak valid.`);
                    }
                }
                throw new Error("Tidak ditemukan format JSON yang valid dalam respons AI.");
            }
            throw new Error("Struktur respons kerangka konten tidak terduga.");
        }
        
        // --- DISPLAY LOGIC ---
        function displayHooks(hooksToDisplay, isHistoryView = false) {
            const resultsGrid = document.getElementById('results-grid');
            const resultsHeader = document.getElementById('results-header');
            const viewHistoryBtn = document.getElementById('view-history-btn');
            const viewFavoritesBtn = document.getElementById('view-favorites-btn');
            
            resultsGrid.innerHTML = '';
            resultsHeader.style.display = 'flex';
            
            const headerTitle = document.querySelector('#results-header h2');
            if (currentView === 'favorites') {
                headerTitle.textContent = '‚≠ê Ide Favorit Anda';
                viewFavoritesBtn.innerHTML = `¬´ Kembali ke Hasil`;
                viewHistoryBtn.innerHTML = `üïí Riwayat`;
            } else if (currentView === 'history') {
                headerTitle.textContent = 'üïí Riwayat Generate';
                if(history.length > 0) {
                    headerTitle.innerHTML += `<button id="clear-history-btn" class="ml-4 text-xs bg-red-500/20 text-red-300 px-2 py-1 rounded-md">Hapus Semua</button>`;
                }
                viewHistoryBtn.innerHTML = `¬´ Kembali ke Hasil`;
                viewFavoritesBtn.innerHTML = `‚≠ê Favorit (<span id="favorite-count">${favorites.length}</span>)`;
            } else {
                headerTitle.textContent = 'Hasil Ide Konten';
                viewFavoritesBtn.innerHTML = `‚≠ê Favorit (<span id="favorite-count">${favorites.length}</span>)`;
                viewHistoryBtn.innerHTML = `üïí Riwayat`;
            }

            if (hooksToDisplay.length === 0) {
                let emptyMessage = 'Generate ide untuk melihat hasilnya di sini.';
                if(currentView === 'favorites') emptyMessage = 'Anda belum punya favorit. Tandai dengan ikon bintang!';
                if(currentView === 'history') emptyMessage = 'Riwayat generate Anda masih kosong.';
                resultsGrid.innerHTML = `<div class="md:col-span-2 text-center text-slate-400 py-8">${emptyMessage}</div>`;
                return;
            }

            hooksToDisplay.forEach((hookData, index) => {
                const isFavorited = favorites.some(fav => fav.hook === hookData.hook);
                const categoryStyle = hookCategoryStyles[hookData.category] || hookCategoryStyles['Default'];
                const toneLabel = hookData.tone ? `<span class="tone-label">${hookData.tone}</span>` : '';
                const card = document.createElement('div');
                card.className = 'bg-slate-800/50 p-5 rounded-2xl fade-in flex flex-col justify-between border border-slate-700/50';
                card.innerHTML = `
                            <div>
                                <div class="flex items-center gap-3 mb-3">
                                    <button class="favorite-btn p-1 text-slate-400 hover:text-yellow-400 transition-colors ${isFavorited ? 'favorited' : ''}" data-hook="${hookData.hook}" data-category="${hookData.category}" data-tone="${hookData.tone || ''}">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-star-fill star-icon" viewBox="0 0 16 16"><path d="M3.612 15.443c-.343.197-.732.026-.976-.316C2.384 14.79 2.421 14.34 2.658 14.1l.099-.101 2.56-2.528-3.797-2.61L.064 6.25c-.26-.193-.398-.5-.358-.814.04-.314.25-.583.543-.695L4.82 3.32 6.59.165c.195-.33.542-.515.91-.492.368.023.68.26.83.585l1.78 3.155 4.542 1.32c.303.088.513.368.553.68.04.313-.098.62-.358.814l-2.823 2.062 1.005 4.423c.06.264-.028.54-.25.728-.222.188-.533.243-.815.145L8 13.34l-3.267 2.007-.093.057-.003.002z"/></svg>
                                    </button>
                                    <button class="text-sm font-semibold px-4 py-1 rounded-full cursor-pointer transition-opacity hover:opacity-80 result-card-category ${categoryStyle}" data-category="${hookData.category}">${hookData.category}</button>
                                    ${toneLabel}
                                    ${isHistoryView ? `<button class="delete-history-item-btn ml-auto p-1 text-slate-500 hover:text-red-400" data-index="${index}" title="Hapus dari riwayat"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash-fill" viewBox="0 0 16 16"><path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z"/></svg></button>`: ''}
                                </div>
                                <p class="text-slate-200 text-lg mb-4">${hookData.hook}</p>
                            </div>
                            <div class="flex items-center gap-2 mt-2">
                                <button class="result-card-copy-btn text-sm font-bold px-4 py-2 rounded-lg" data-hook="${hookData.hook}">Salin</button>
                                <button class="result-card-script-btn flex-1 text-sm font-bold px-4 py-2 rounded-lg flex items-center justify-center gap-2" data-hook="${hookData.hook}">‚ú® Buat Script</button>
                            </div>
                        `;
                resultsGrid.appendChild(card);
            });
        }
        
        function displayStructuredScript(data) {
            const container = document.getElementById('script-result-container');
            currentScriptData = data;
            container.innerHTML = ''; 

            const sectionIcons = { saran_audio: 'üéµ', hook_scene: 'üé¨', masalah: 'üòü', solusi: 'üí°', cta: 'üöÄ', caption: '‚úçÔ∏è', hashtags: '#Ô∏è‚É£' };
            const sectionTitles = { saran_audio: 'Saran Audio Trending', hook_scene: 'Hook (Scene)', masalah: 'Masalah', solusi: 'Solusi', cta: 'CTA', caption: 'Caption', hashtags: 'Hashtags' };
            const sectionOrder = ["saran_audio", "hook_scene", "masalah", "solusi", "cta", "caption", "hashtags"];

            sectionOrder.forEach(key => {
                if (!data[key] || (Array.isArray(data[key]) && data[key].length === 0)) return;

                const sectionWrapper = document.createElement('div');
                sectionWrapper.className = 'script-section-wrapper';
                sectionWrapper.dataset.sectionKey = key;
                
                const isAudioSection = key === 'saran_audio';
                if(isAudioSection) sectionWrapper.classList.add('kerangka-audio-section');

                let displayHTML = ''; let editHTML = '';

                if (key === 'saran_audio') {
                    const audioList = data[key].map(audio => 
                        `<span class="audio-suggestion" data-title="${audio.title}" data-artist="${audio.artist || ''}">'${audio.title}' by ${audio.artist || 'Unknown'}</span>`
                    ).join('; ');
                    displayHTML = `<div class="pl-7"><p class="text-slate-200">${audioList}</p></div>`;
                    editHTML = `<textarea class="w-full h-24 p-2 rounded-md edit-textarea">${data[key].map(a => `${a.title} by ${a.artist}`).join(', ')}</textarea>`;
                } else if (key === 'hashtags') {
                    const contentArray = Array.isArray(data[key]) ? data[key] : [data[key]];
                    const contentString = contentArray.join(', ');
                    const displayContent = contentArray.map(tag => `<span class="hashtag" data-tag="${tag}">#${tag}</span>`).join(' ');
                    
                    displayHTML = `<div class="pl-7"><div class="flex flex-wrap gap-2">${displayContent}</div></div>`;
                    editHTML = `<textarea class="w-full h-24 p-2 rounded-md edit-textarea">${contentString}</textarea>`;
                } else if (key === 'caption') {
                    displayHTML = `<div class="pl-7"><p class="text-slate-300 whitespace-pre-wrap">${data[key]}</p></div>`;
                    editHTML = `<textarea class="w-full h-24 p-2 rounded-md edit-textarea">${data[key]}</textarea>`;
                } else if (typeof data[key] === 'object' && data[key] !== null) {
                    const item = data[key];
                    displayHTML = `<div class="pl-7 space-y-2">
                                     <p class="text-sm text-slate-400">üïí Detik ${item.durasi || ''} (Estimasi: ${item.estimasi || '?'} detik)</p>
                                     <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 text-slate-300 text-sm">
                                         <p>üåç <strong class="font-medium text-slate-100/80">Lokasi:</strong> ${item.lokasi || ''}</p>
                                         <p>üì¶ <strong class="font-medium text-slate-100/80">Properti:</strong> ${item.properti || ''}</p>
                                         <p>üí° <strong class="font-medium text-slate-100/80">Pencahayaan:</strong> ${item.pencahayaan || ''}</p>
                                         <p>üé≠ <strong class="font-medium text-slate-100/80">Mood:</strong> ${item.mood || ''}</p>
                                     </div>
                                     <hr class="border-slate-700 my-2">
                                     <p class="text-slate-300">üì∏ <strong class="text-slate-100/80 font-medium">VISUAL:</strong> ${item.visual || ''}</p>
                                     <p class="text-slate-300">üé§ <strong class="text-slate-100/80 font-medium">NARASI:</strong> ${item.narasi || ''}</p>
                                     <p>üé¨ <span class="saran-shot-text">Saran Shot: ${item.saran_shot || ''}</span></p>
                                 </div>`;
                    
                    editHTML = `<div class="space-y-2">
                                     <label class="block text-xs text-slate-400">Lokasi</label><textarea class="w-full h-12 p-2 rounded-md edit-textarea" data-field="lokasi">${item.lokasi || ''}</textarea>
                                     <label class="block text-xs text-slate-400">Properti</label><textarea class="w-full h-12 p-2 rounded-md edit-textarea" data-field="properti">${item.properti || ''}</textarea>
                                     <label class="block text-xs text-slate-400">Pencahayaan</label><textarea class="w-full h-12 p-2 rounded-md edit-textarea" data-field="pencahayaan">${item.pencahayaan || ''}</textarea>
                                     <label class="block text-xs text-slate-400">Mood</label><textarea class="w-full h-12 p-2 rounded-md edit-textarea" data-field="mood">${item.mood || ''}</textarea>
                                     <label class="block text-xs text-slate-400">Visual</label><textarea class="w-full h-20 p-2 rounded-md edit-textarea" data-field="visual">${item.visual || ''}</textarea>
                                     <label class="block text-xs text-slate-400">Narasi</label><textarea class="w-full h-20 p-2 rounded-md edit-textarea" data-field="narasi">${item.narasi || ''}</textarea>
                                 </div>`;
                }

                sectionWrapper.innerHTML = `
                    <div class="script-section-display">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-lg font-bold text-slate-100 ${isAudioSection ? 'text-xl' : ''}">${sectionIcons[key]} ${sectionTitles[key]}</h3>
                            <div class="flex items-center gap-3">
                                <button class="edit-section-btn p-1 text-slate-400 hover:text-white" title="Edit bagian ini"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16"><path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/><path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/></svg></button>
                                <button class="copy-section-btn p-1 text-slate-400 hover:text-white" title="Salin bagian ini">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-files" viewBox="0 0 16 16">
                                        <path d="M13 0H6a2 2 0 0 0-2 2v1h1V2a1 1 0 0 1 1-1h7a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1h-2v1h2a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                                        <path d="M2 4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H2zm7 11H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h7a1 1 0 0 1 1 1v9a1 1 0 0 1-1 1z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        ${displayHTML}
                    </div>
                    <div class="script-edit-view hidden">
                        <h3 class="text-xl font-bold text-slate-100 mb-4">${sectionIcons[key]} Edit ${sectionTitles[key]}</h3>
                        ${editHTML}
                        <div class="flex gap-3 mt-4">
                            <button class="save-edit-btn flex-1 text-white font-bold py-2 px-4 rounded-lg bg-green-600 hover:bg-green-700 transition-colors">Simpan</button>
                            <button class="cancel-edit-btn flex-1 text-slate-300 font-bold py-2 px-4 rounded-lg bg-slate-600 hover:bg-slate-700 transition-colors">Batal</button>
                        </div>
                    </div>`;
                container.appendChild(sectionWrapper);
            });
            document.getElementById('script-buttons').style.display = 'grid';
            document.getElementById('script-disclaimer').style.display = 'block';
        }
        
        // --- FAVORITES, HISTORY, SCHEDULE LOGIC ---
        function toggleFavorite(hookData) {
            const index = favorites.findIndex(fav => fav.hook === hookData.hook);
            if (index > -1) { favorites.splice(index, 1); showNotification('Dihapus dari favorit!'); } 
            else { favorites.push(hookData); showNotification('Ditambahkan ke favorit!'); }
            saveFavorites(); 
            updateFavoriteCount();
            if (currentView === 'favorites') {
                displayHooks(favorites);
            } else {
                updateCurrentViewDisplay();
            }
        }
        function saveFavorites() { localStorage.setItem('contentCheatFavorites', JSON.stringify(favorites)); }
        function loadFavorites() { favorites = JSON.parse(localStorage.getItem('contentCheatFavorites')) || []; updateFavoriteCount(); }
        function updateFavoriteCount() { 
            const favCountEl = document.getElementById('favorite-count');
            if (favCountEl) favCountEl.textContent = favorites.length; 
        }

        function addToHistory(hooks) {
            history.unshift(...hooks);
            if (history.length > 50) { history.length = 50; } // Keep last 50 hooks
            saveHistory();
        }
        function saveHistory() { localStorage.setItem('contentCheatHistory', JSON.stringify(history)); }
        function loadHistory() { history = JSON.parse(localStorage.getItem('contentCheatHistory')) || []; }
        function deleteHistoryItem(index) {
            history.splice(index, 1);
            saveHistory();
            displayHooks(history, true);
        }
        function clearHistory() {
            const customConfirmModal = document.createElement('div');
            customConfirmModal.className = 'modal-overlay visible';
            customConfirmModal.innerHTML = `
                <div class="modal-content !max-w-sm">
                    <h3 class="text-xl font-bold text-white mb-4">Konfirmasi</h3>
                    <p class="text-slate-300 mb-6">Anda yakin ingin menghapus semua riwayat?</p>
                    <div class="flex gap-4">
                        <button id="confirm-delete-history" class="flex-1 text-white font-bold py-2 px-4 rounded-lg bg-red-600 hover:bg-red-700">Ya, Hapus</button>
                        <button id="cancel-delete-history" class="flex-1 text-slate-300 font-bold py-2 px-4 rounded-lg bg-slate-600 hover:bg-slate-700">Batal</button>
                    </div>
                </div>
            `;
            document.body.appendChild(customConfirmModal);

            document.getElementById('confirm-delete-history').onclick = () => {
                history = [];
                saveHistory();
                displayHooks(history, true);
                showNotification('Riwayat berhasil dihapus.');
                document.body.removeChild(customConfirmModal);
            };
            document.getElementById('cancel-delete-history').onclick = () => {
                document.body.removeChild(customConfirmModal);
            };
        }
        
        function updateCurrentViewDisplay() {
            if (currentView === 'favorites') {
                displayHooks(favorites);
            } else if (currentView === 'history') {
                displayHooks(history, true);
            } else {
                displayHooks(lastGeneratedHooks);
            }
        }

        // --- CALENDAR LOGIC ---
        function loadScheduledContent() {
            const loadedSchedule = JSON.parse(localStorage.getItem('contentCheatSchedule')) || {};
            // Migrasi data lama ke struktur baru
            Object.keys(loadedSchedule).forEach(date => {
                loadedSchedule[date].forEach(item => {
                    if (item.platform && item.status && !item.platforms) {
                        item.platforms = { [item.platform]: item.status };
                        delete item.platform;
                        delete item.status;
                    }
                });
            });
            scheduledContent = loadedSchedule;
            saveScheduledContent();
        }

        function saveScheduledContent() {
            localStorage.setItem('contentCheatSchedule', JSON.stringify(scheduledContent));
        }
        function renderCalendar(isScheduling = false) {
            const year = calendarDate.getFullYear();
            const month = calendarDate.getMonth();
            const monthNames = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
            document.getElementById('month-year-header').textContent = `${monthNames[month]} ${year}`;

            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = '';
            ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'].forEach(day => {
                grid.innerHTML += `<div class="calendar-header-day">${day}</div>`;
            });

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();

            for (let i = 0; i < firstDay; i++) {
                grid.innerHTML += `<div class="calendar-day other-month"></div>`;
            }

            for (let i = 1; i <= daysInMonth; i++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                dayEl.innerHTML = `<span>${i}</span>`;
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                dayEl.dataset.date = dateStr;

                if (year === today.getFullYear() && month === today.getMonth() && i === today.getDate()) {
                    dayEl.classList.add('today');
                }
                
                if (scheduledContent[dateStr] && scheduledContent[dateStr].length > 0) {
                    const dot = document.createElement('div');
                    dot.className = 'scheduled-dot';
                    dayEl.appendChild(dot);
                }
                
                dayEl.addEventListener('click', () => {
                    if (isScheduling) {
                        selectedDateForScheduling = dateStr;
                        document.querySelectorAll('.calendar-day.selected').forEach(el => el.classList.remove('selected'));
                        dayEl.classList.add('selected');
                        document.getElementById('calendar-actions').style.display = 'block';
                    } else {
                        showCalendarDetails(dateStr);
                    }
                });
                grid.appendChild(dayEl);
            }
            
            if (!isScheduling) {
                 document.getElementById('calendar-actions').style.display = 'none';
                 const todayStr = new Date().toISOString().split('T')[0];
                 const selectedDay = document.querySelector('.calendar-day.selected');
                 showCalendarDetails(selectedDay ? selectedDay.dataset.date : todayStr);
            }
        }

        function showCalendarDetails(dateStr) {
            document.querySelectorAll('.calendar-day.selected').forEach(el => el.classList.remove('selected'));
            const dayEl = document.querySelector(`.calendar-day[data-date="${dateStr}"]`);
            if(dayEl) dayEl.classList.add('selected');

            const detailsContainer = document.getElementById('calendar-details');
            const contentForDate = scheduledContent[dateStr];
            
            const formatDate = (ds) => new Date(ds + 'T00:00:00').toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            detailsContainer.innerHTML = `<h4 class="font-bold text-lg mb-2">Jadwal untuk ${formatDate(dateStr)}</h4>`;

            if (contentForDate && contentForDate.length > 0) {
                contentForDate.forEach((item, index) => {
                    const hookText = item.hook_scene ? item.hook_scene.narasi : 'Konten terjadwal';
                    
                    // Perubahan 4 & 5: Opsi status baru dan UI per platform
                    const statusOptions = ['-', 'Siap Upload', 'Proses Take Video', 'Proses Edit Video', 'Sudah Upload', 'Revisi', 'Proses Evaluasi'];
                    const allPlatforms = ['IG', 'FB', 'TikTok', 'YouTube', 'Shopee', 'TokPed'];
                    
                    let platformStatusesHTML = '<div class="space-y-2 mt-2">';
                    allPlatforms.forEach(platform => {
                        const currentStatus = (item.platforms && item.platforms[platform]) ? item.platforms[platform] : '-';
                        const selectOptions = statusOptions.map(s => `<option value="${s}" ${currentStatus === s ? 'selected' : ''}>${s}</option>`).join('');
                        
                        platformStatusesHTML += `
                            <div class="flex items-center justify-between gap-2 text-sm">
                                <label for="status-${dateStr}-${index}-${platform}" class="text-slate-300 w-20">${platform}</label>
                                <select id="status-${dateStr}-${index}-${platform}" class="status-select-per-platform w-full p-1 rounded text-xs" data-date="${dateStr}" data-index="${index}" data-platform="${platform}">
                                    ${selectOptions}
                                </select>
                            </div>
                        `;
                    });
                    platformStatusesHTML += '</div>';

                    const itemEl = document.createElement('div');
                    itemEl.className = 'p-3 bg-slate-800/50 rounded-lg mb-2';
                    itemEl.innerHTML = `
                        <div class="flex justify-between items-start">
                             <p class="text-slate-200 flex-1 pr-4"><strong class="text-purple-300">#${index + 1}</strong> ${hookText.substring(0, 70)}...</p>
                             <div class="flex items-center gap-2">
                                 <button class="edit-schedule-btn p-1 text-slate-400 hover:text-white" data-date="${dateStr}" data-index="${index}" title="Edit"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zM14.247 3.36l-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/><path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/></svg></button>
                                 <button class="move-schedule-btn p-1 text-slate-400 hover:text-white" data-date="${dateStr}" data-index="${index}" title="Pindah Tanggal"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/></svg></button>
                                 <button class="delete-schedule-btn p-1 text-slate-400 hover:text-red-400" data-date="${dateStr}" data-index="${index}" title="Hapus"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z"/></svg></button>
                             </div>
                        </div>
                        ${platformStatusesHTML}
                    `;
                    detailsContainer.appendChild(itemEl);
                });
            } else {
                detailsContainer.innerHTML += `<p class="text-slate-400">Tidak ada jadwal untuk tanggal ini.</p>`;
            }
        }

        function showDeleteConfirmation(date, index) {
            const customConfirmModal = document.createElement('div');
            customConfirmModal.className = 'modal-overlay visible';
            customConfirmModal.style.zIndex = '60'; // Ensure it's on top of other modals
            customConfirmModal.innerHTML = `
                <div class="modal-content !max-w-sm">
                    <h3 class="text-xl font-bold text-white mb-4">Konfirmasi Hapus</h3>
                    <p class="text-slate-300 mb-6">Anda yakin ingin menghapus jadwal konten ini?</p>
                    <div class="flex gap-4">
                        <button id="confirm-delete" class="flex-1 text-white font-bold py-2 px-4 rounded-lg bg-red-600 hover:bg-red-700">Ya, Hapus</button>
                        <button id="cancel-delete" class="flex-1 text-slate-300 font-bold py-2 px-4 rounded-lg bg-slate-600 hover:bg-slate-700">Batal</button>
                    </div>
                </div>
            `;
            document.body.appendChild(customConfirmModal);

            document.getElementById('confirm-delete').onclick = () => {
                scheduledContent[date].splice(index, 1);
                if (scheduledContent[date].length === 0) {
                    delete scheduledContent[date];
                }
                saveScheduledContent();
                showCalendarDetails(date);
                renderCalendar(); // Re-render to update dot
                showNotification('Jadwal berhasil dihapus.');
                document.body.removeChild(customConfirmModal);
            };
            document.getElementById('cancel-delete').onclick = () => {
                document.body.removeChild(customConfirmModal);
            };
        }


        // --- MODAL & EXPLANATION LOGIC ---
        function showHookExplanation(category) {
            const modal = document.getElementById('hookExplanationModal');
            const explanationData = hookExplanations[category];
            if (explanationData) {
                document.getElementById('explanation-title').textContent = `${category}`;
                document.getElementById('explanation-body').innerHTML = `
                    <h3 class="font-bold text-slate-100 mb-1">Deskripsi</h3>
                    <p class="text-slate-300 mb-4">${explanationData.desc}</p>
                    <h3 class="font-bold text-lg text-slate-100 mb-1">Paling Efektif Untuk</h3>
                    <p class="efektif-title">${explanationData.efektif}</p>`;
                modal.classList.add('visible');
            }
        }
        
        function populatePustaka() {
            const container = document.getElementById('pustaka-body');
            container.innerHTML = '';
            for (const [title, data] of Object.entries(hookExplanations)) {
                const categoryStyle = hookCategoryStyles[title] || hookCategoryStyles['Default'];
                const entry = document.createElement('div');
                entry.className = 'pustaka-entry';
                entry.innerHTML = `
                    <div class="hook-label-container mb-1">
                        <div class="hook-label-dot ${categoryStyle.split(' ')[0]}"></div>
                        <h3 class="font-bold text-lg ${categoryStyle.split(' ')[1]}">${title}</h3>
                    </div>
                    <p class="mt-1">${data.desc}</p>
                    <p class="mt-2"><strong class="efektif-title">Paling Efektif Untuk:</strong> <span class="text-yellow-300">${data.efektif}</span></p>`;
                container.appendChild(entry);
            }
        }
        
        // --- QUOTA MANAGEMENT ---
        const quotaManager = {
            getQuotaData: () => JSON.parse(localStorage.getItem('userQuotaData')) || { quotaLeft: 200, lastReset: '' },
            saveQuotaData: (data) => localStorage.setItem('userQuotaData', JSON.stringify(data)),
            checkAndResetQuota: function() {
                const today = new Date().toISOString().split('T')[0];
                let data = this.getQuotaData();
                if (data.lastReset !== today) { data.quotaLeft = 200; data.lastReset = today; this.saveQuotaData(data); }
                this.updateDisplay(data.quotaLeft);
            },
            decrementQuota: function() {
                let data = this.getQuotaData();
                if (data.quotaLeft > 0) { data.quotaLeft -= 1; this.saveQuotaData(data); this.updateDisplay(data.quotaLeft); }
            },
            updateDisplay: function(quota) {
                const counterEl = document.getElementById('quota-counter');
                if(counterEl) {
                    counterEl.textContent = quota;
                    counterEl.classList.toggle('text-red-400', quota < 20); counterEl.classList.toggle('text-green-400', quota >= 20);
                }
                const generateBtn = document.getElementById('generateBtn');
                if (generateBtn) {
                    generateBtn.disabled = quota <= 0;
                }
            }
        };

        // --- APP INITIALIZATION & EVENT LISTENERS ---
        function checkLogin() {
            if (sessionStorage.getItem('isLoggedIn') === 'true') {
                document.getElementById('loginModal').classList.remove('visible');
                checkApiKey();
            } else {
                const savedCreds = localStorage.getItem('savedUserCredentials');
                if (savedCreds) {
                    const { username, password } = JSON.parse(savedCreds);
                    document.getElementById('username').value = username;
                    document.getElementById('password').value = password;
                    document.getElementById('remember-me').checked = true;
                }
                document.getElementById('loginModal').classList.add('visible');
            }
        }

        function checkApiKey() {
            const storedApiKey = localStorage.getItem('userGeminiApiKey');
            if (storedApiKey) {
                userAPIKey = storedApiKey;
                document.getElementById('app-container').style.display = 'block';
                document.getElementById('apiKeyModal').classList.remove('visible');
                quotaManager.checkAndResetQuota(); 
                loadFavorites(); 
                loadHistory(); 
                loadScheduledContent();
                populatePustaka();
            } else {
                document.getElementById('app-container').style.display = 'none';
                document.getElementById('cancelChangeApiKeyBtn').classList.add('hidden');
                document.getElementById('apiKeyModal').classList.add('visible');
            }
        }
        
        document.querySelectorAll('.close-modal-btn').forEach(btn => {
             btn.addEventListener('click', (e) => { 
                 e.stopPropagation();
                 const modal = btn.closest('.modal-overlay');

                 if (modal.id === 'apiKeyModal' && !localStorage.getItem('userGeminiApiKey')) {
                     sessionStorage.removeItem('isLoggedIn');
                     modal.classList.remove('visible');
                     document.getElementById('loginModal').classList.add('visible');
                 } else {
                     modal.classList.remove('visible');
                 }
            });
        });
        
        document.getElementById('loginBtn').addEventListener('click', () => {
            const user = document.getElementById('username').value;
            const pass = document.getElementById('password').value;
            const rememberMe = document.getElementById('remember-me').checked;
            const errorMsg = document.getElementById('loginErrorMsg');
            const loginModalContent = document.querySelector('#loginModal .modal-content');
            
            if (user === 'username' && pass === 'followIG@brata_putra') {
                sessionStorage.setItem('isLoggedIn', 'true');
                if (rememberMe) {
                    localStorage.setItem('savedUserCredentials', JSON.stringify({ username: user, password: pass }));
                } else {
                    localStorage.removeItem('savedUserCredentials');
                }
                errorMsg.style.display = 'none';
                loginModalContent.classList.remove('shake');
                checkLogin();
            } else {
                errorMsg.style.display = 'block';
                loginModalContent.classList.add('shake');
                setTimeout(() => {
                    loginModalContent.classList.remove('shake');
                }, 820);
            }
        });

        document.getElementById('saveApiKeyBtn').addEventListener('click', () => {
            const apiKeyInput = document.getElementById('apiKeyInput').value.trim();
            if (apiKeyInput) {
                localStorage.setItem('userGeminiApiKey', apiKeyInput);
                localStorage.removeItem('userQuotaData');
                checkApiKey();
                showNotification('API Key berhasil disimpan!', false);
            } else {
                showNotification('Mohon masukkan API Key.', true);
            }
        });
        
        document.getElementById('changeApiKey').addEventListener('click', () => {
            document.getElementById('cancelChangeApiKeyBtn').classList.remove('hidden');
            document.getElementById('apiKeyModal').classList.add('visible');
        });

        document.getElementById('cancelChangeApiKeyBtn').addEventListener('click', () => {
            document.getElementById('apiKeyModal').classList.remove('visible');
        });
        
        document.getElementById('togglePasswordVisibility').addEventListener('click', () => {
            const passwordInput = document.getElementById('password');
            const eyeShow = document.getElementById('eye-show');
            const eyeHide = document.getElementById('eye-hide');
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            eyeShow.classList.toggle('hidden');
            eyeHide.classList.toggle('hidden');
        });

        document.getElementById('howToGetApiKeyBtn').addEventListener('click', () => { document.getElementById('tutorialModal').classList.add('visible'); });
        document.getElementById('pustaka-hook-btn').addEventListener('click', () => { document.getElementById('pustakaHookModal').classList.add('visible'); });
        document.getElementById('faq-btn').addEventListener('click', () => { document.getElementById('faqModal').classList.add('visible'); });
        document.getElementById('apiKeyFaqBtn').addEventListener('click', () => { document.getElementById('apiKeyFaqModal').classList.add('visible'); });
        
        document.getElementById('openTutorialFromFaq').addEventListener('click', () => {
            document.getElementById('apiKeyFaqModal').classList.remove('visible');
            document.getElementById('tutorialModal').classList.add('visible');
        });
        
        let loadingInterval;
        document.getElementById('generateBtn').addEventListener('click', async () => {
            if (quotaManager.getQuotaData().quotaLeft <= 0) { 
                showNotification('Maaf, kuota generate harian Anda sudah habis. Coba lagi besok.', true); 
                return; 
            }
            const topic = document.getElementById('topic').value.trim();
            if (!topic) { showNotification('Mohon isi Produk / Jasa Anda terlebih dahulu.', true); return; }
            
            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = true;

            const loadingMessages = [ "Menganalisis produk Anda...", "Mencari ide-ide kreatif...", "Menyusun kata-kata...", "Hampir selesai..." ];
            let messageIndex = 0;
            generateBtn.innerHTML = `<div class="spinner !w-6 !h-6 !border-4"></div><span id="loading-text">${loadingMessages[messageIndex]}</span>`;

            loadingInterval = setInterval(() => {
                messageIndex = (messageIndex + 1) % loadingMessages.length;
                const loadingSpan = document.getElementById('loading-text');
                if (loadingSpan) loadingSpan.textContent = loadingMessages[messageIndex];
            }, 2000);

            try {
                const hooks = await generateAIHooks(
                    topic, 
                    document.getElementById('audience').value.trim(), 
                    document.getElementById('details').value.trim(), 
                    document.getElementById('hook-type').value, 
                    document.getElementById('hook-count').value,
                    document.getElementById('tone-of-voice').value,
                    userAPIKey
                );
                quotaManager.decrementQuota();
                lastGeneratedHooks = hooks;
                currentView = 'results';
                updateCurrentViewDisplay();
            } catch (error) {
                console.error('AI Generation Error:', error);
                if (error.message.includes("API Key tidak valid")) {
                    showNotification("API Key tidak valid. Mohon periksa kembali.", true);
                    localStorage.removeItem('userGeminiApiKey'); 
                    checkApiKey();
                } else if (error.message === "API_QUOTA_EXCEEDED") {
                    showNotification("Kuota API Key Anda habis (60 permintaan/menit). Beri jeda 1 menit.", true);
                } else {
                    showNotification(error.message, true);
                }
            } finally {
                clearInterval(loadingInterval);
                generateBtn.disabled = quotaManager.getQuotaData().quotaLeft <= 0;
                generateBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path></svg> Generate Konten!';
            }
        });

        document.getElementById('view-favorites-btn').addEventListener('click', () => {
            currentView = (currentView === 'favorites') ? 'results' : 'favorites';
            updateCurrentViewDisplay();
        });

        document.getElementById('view-history-btn').addEventListener('click', () => {
            currentView = (currentView === 'history') ? 'results' : 'history';
            updateCurrentViewDisplay();
        });

        document.getElementById('results-header').addEventListener('click', (e) => {
            const clearHistoryBtn = e.target.closest('#clear-history-btn');
            if (clearHistoryBtn) {
                clearHistory();
            }
        });
        
        document.getElementById('results-grid').addEventListener('click', async (e) => {
            const scriptBtn = e.target.closest('.result-card-script-btn');
            const copyBtn = e.target.closest('.result-card-copy-btn');
            const favBtn = e.target.closest('.favorite-btn');
            const categoryBtn = e.target.closest('.result-card-category');
            const deleteHistoryBtn = e.target.closest('.delete-history-item-btn');

            if (deleteHistoryBtn) {
                deleteHistoryItem(parseInt(deleteHistoryBtn.dataset.index));
            } else if (categoryBtn) {
                showHookExplanation(categoryBtn.dataset.category);
            } else if (favBtn) {
                toggleFavorite({ 
                    hook: favBtn.dataset.hook, 
                    category: favBtn.dataset.category,
                    tone: favBtn.dataset.tone
                });
            } else if (copyBtn) {
                fallbackCopy(copyBtn.dataset.hook);
            } else if (scriptBtn) {
                if (quotaManager.getQuotaData().quotaLeft <= 0) { 
                    showNotification('Maaf, kuota generate harian Anda sudah habis. Coba lagi besok.', true); 
                    return; 
                }
                const hookText = scriptBtn.dataset.hook;
                const modal = document.getElementById('scriptModal');
                const resultContainer = document.getElementById('script-result-container');
                document.getElementById('script-buttons').style.display = 'none';
                document.getElementById('script-disclaimer').style.display = 'none';

                let scriptLoadingInterval;
                const scriptLoadingMessages = [ "Menganalisis hook...", "Merancang visual & narasi...", "Menyiapkan hasil..." ];
                let scriptMessageIndex = 0;
                resultContainer.innerHTML = `<div class="flex flex-col justify-center items-center h-full gap-4 py-8">
                    <div class="script-loading-spinner"></div>
                    <p id="script-loading-text" class="text-slate-400">${scriptLoadingMessages[0]}</p>
                </div>`;
                scriptLoadingInterval = setInterval(() => {
                    scriptMessageIndex = (scriptMessageIndex + 1) % scriptLoadingMessages.length;
                    const loadingSpan = document.getElementById('script-loading-text');
                    if (loadingSpan) loadingSpan.textContent = scriptLoadingMessages[scriptMessageIndex];
                }, 2000);

                modal.classList.add('visible');
                
                try {
                    const scriptData = await generateAIScript(hookText, userAPIKey, uploadedImageBase64);
                    quotaManager.decrementQuota();
                    displayStructuredScript(scriptData);
                } catch (error) {
                    console.error('Script Generation Error:', error);
                    let errorMessage = `Gagal membuat kerangka: ${error.message}`;
                    if (error.message === "API_QUOTA_EXCEEDED") {
                        errorMessage = "Kuota API Key Anda habis (60 permintaan/menit). Beri jeda 1 menit.";
                    }
                    resultContainer.innerHTML = `<p class="text-red-400 text-center">${errorMessage}</p>`;
                } finally {
                    clearInterval(scriptLoadingInterval);
                }
            }
        });

        document.getElementById('script-result-container').addEventListener('click', e => {
            const hashtagSpan = e.target.closest('.hashtag');
            const audioSpan = e.target.closest('.audio-suggestion');
            const wrapper = e.target.closest('.script-section-wrapper');

            if (hashtagSpan) {
                const tag = hashtagSpan.dataset.tag;
                document.getElementById('hashtag-title').textContent = `#${tag}`;
                document.getElementById('instagram-link').href = `https://www.instagram.com/explore/tags/${tag}/`;
                document.getElementById('tiktok-link').href = `https://www.tiktok.com/tag/${tag}`;
                document.getElementById('facebook-link').href = `https://www.facebook.com/hashtag/${tag}`;
                document.getElementById('hashtagModal').classList.add('visible');
            } else if (audioSpan) {
                const title = audioSpan.dataset.title;
                const artist = audioSpan.dataset.artist;
                const fullQuery = `${title} ${artist}`;
                document.getElementById('audio-title').textContent = `'${title}' by ${artist}`;
                document.getElementById('youtube-audio-link').href = `https://www.youtube.com/results?search_query=${encodeURIComponent(fullQuery)}`;
                document.getElementById('spotify-audio-link').href = `https://open.spotify.com/search/${encodeURIComponent(fullQuery)}`;
                document.getElementById('audioSearchModal').classList.add('visible');
            } else if (wrapper) {
                const editBtn = e.target.closest('.edit-section-btn');
                const saveBtn = e.target.closest('.save-edit-btn');
                const cancelBtn = e.target.closest('.cancel-edit-btn');
                const copyBtn = e.target.closest('.copy-section-btn');
                
                if(editBtn) {
                    wrapper.querySelector('.script-section-display').classList.add('hidden');
                    wrapper.querySelector('.script-edit-view').classList.remove('hidden');
                }
                if(cancelBtn) {
                    wrapper.querySelector('.script-section-display').classList.remove('hidden');
                    wrapper.querySelector('.script-edit-view').classList.add('hidden');
                }
                if(saveBtn) {
                    const sectionKey = wrapper.dataset.sectionKey;
                    const sectionData = currentScriptData[sectionKey];
                    if (typeof sectionData === 'object' && sectionData !== null && !Array.isArray(sectionData)) {
                        wrapper.querySelectorAll('textarea').forEach(area => { currentScriptData[sectionKey][area.dataset.field] = area.value; });
                    } else {
                        const mainTextarea = wrapper.querySelector('textarea');
                        if (Array.isArray(sectionData)) { 
                            if (sectionKey === 'saran_audio') {
                                currentScriptData[sectionKey] = [{ title: mainTextarea.value, artist: 'Custom' }];
                            } else {
                                currentScriptData[sectionKey] = mainTextarea.value.split(',').map(item => item.trim()); 
                            }
                        } 
                        else { currentScriptData[sectionKey] = mainTextarea.value; }
                    }
                    displayStructuredScript(currentScriptData);
                    showNotification('Perubahan berhasil disimpan!', false);
                }
                if (copyBtn) {
                    const sectionKey = wrapper.dataset.sectionKey;
                    const sectionData = currentScriptData[sectionKey];
                    let textToCopy = '';
                    if (typeof sectionData === 'string') textToCopy = sectionData;
                    else if (Array.isArray(sectionData)) {
                        if (sectionKey === 'saran_audio') {
                           textToCopy = sectionData.map(a => `'${a.title}' by ${a.artist}`).join('; ');
                        } else {
                           textToCopy = '#' + sectionData.join(' #');
                        }
                    }
                    else if (typeof sectionData === 'object' && sectionData !== null) {
                        textToCopy = `Lokasi: ${sectionData.lokasi}\nProperti: ${sectionData.properti}\nPencahayaan: ${sectionData.pencahayaan}\nMood: ${sectionData.mood}\n\nVISUAL: ${sectionData.visual}\nNARASI: ${sectionData.narasi}\nSARAN SHOT: ${sectionData.saran_shot}`;
                    }
                    fallbackCopy(textToCopy);
                }
            }
        });

        document.getElementById('script-buttons').addEventListener('click', (e) => {
             const buttonId = e.target.id;
             if (buttonId === 'schedule-btn') {
                 if (!currentScriptData) return;
                 calendarDate = new Date();
                 renderCalendar(true); // Render in scheduling mode
                 document.getElementById('calendarModal').classList.add('visible');
             }
             
             // Perubahan 2: Logika Tombol Export to Google Docs
             if (buttonId === 'copy-gdocs-btn') {
                 if (!currentScriptData) return;
                 let fullText = getFullScriptAsText();
                 fallbackCopy(fullText, 'Teks disalin! Buka Google Docs dan paste (Ctrl+V).');
                 setTimeout(() => {
                    window.open('https://docs.new', '_blank');
                 }, 100);
             }

             if (buttonId === 'copy-all-script-btn') {
                 if (!currentScriptData) return;
                 fallbackCopy(getFullScriptAsText());
             }
             
             if (buttonId === 'download-doc-btn') {
                if (!currentScriptData) return;
                let content = `<h1>Kerangka Konten AI</h1>`;
                const sectionTitles = { saran_audio: 'Saran Audio Trending', hook_scene: 'Hook (Scene)', masalah: 'Masalah', solusi: 'Solusi', cta: 'CTA', caption: 'Caption', hashtags: 'Hashtags' };
                const sectionOrder = ["saran_audio", "hook_scene", "masalah", "solusi", "cta", "caption", "hashtags"];
                sectionOrder.forEach(key => {
                    if(currentScriptData[key]) {
                        content += `<h2>${sectionTitles[key]}</h2>`;
                        const data = currentScriptData[key];
                        if (key === 'saran_audio') {
                            content += `<p>${data.map(a => `'${a.title}' by ${a.artist}`).join('; ')}</p>`;
                        } else if (key === 'hashtags') {
                             content += `<p>${'#' + data.join(' #')}</p>`;
                        } else if (typeof data === 'string') { 
                            content += `<p>${data.replace(/\n/g, '<br>')}</p>`;
                        } else if (typeof data === 'object') { 
                            content += `<p><b>Durasi:</b> Detik ${data.durasi}<br/><b>Lokasi:</b> ${data.lokasi}<br/><b>Properti:</b> ${data.properti}<br/><b>Pencahayaan:</b> ${data.pencahayaan}<br/><b>Mood:</b> ${data.mood}<br/><br/><b>Visual:</b> ${data.visual}<br/><b>Narasi:</b> ${data.narasi}<br/><b>Saran Shot:</b> ${data.saran_shot}</p>`;
                        }
                    }
                });
                const blob = new Blob(['<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40"><head><meta charset="utf-8"><title>Kerangka Konten</title></head><body>' + content + '</body></html>'], {type: 'application/msword'});
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                const topicValue = document.getElementById('topic').value.trim().toUpperCase();
                const fileName = `SCRIPT ${topicValue || 'KONTEN'}.doc`;
                link.download = fileName;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
             }
        });
        
        function getFullScriptAsText() {
            if (!currentScriptData) return "";
            let fullText = "‚ú® Kerangka Konten AI ‚ú®\n\n";
            const sectionTitles = { saran_audio: 'Saran Audio Trending', hook_scene: 'Hook (Scene)', masalah: 'Masalah', solusi: 'Solusi', cta: 'CTA', caption: 'Caption', hashtags: 'Hashtags' };
            const sectionOrder = ["saran_audio", "hook_scene", "masalah", "solusi", "cta", "caption", "hashtags"];
            sectionOrder.forEach(key => {
                if(currentScriptData[key]) {
                    fullText += `--- ${sectionTitles[key].toUpperCase()} ---\n`;
                     const data = currentScriptData[key];
                     if (key === 'saran_audio') {
                          fullText += data.map(a => `'${a.title}' by ${a.artist}`).join('; ') + '\n\n';
                     } else if (key === 'hashtags') {
                          fullText += '#' + data.join(' #') + '\n\n';
                     } else if (typeof data === 'string') { 
                          fullText += data + '\n\n'; 
                     } else if (typeof data === 'object') { 
                          fullText += `Durasi: Detik ${data.durasi}\nLokasi: ${data.lokasi}\nProperti: ${data.properti}\nPencahayaan: ${data.pencahayaan}\nMood: ${data.mood}\n\nVisual: ${data.visual}\nNarasi: ${data.narasi}\nSaran Shot: ${data.saran_shot}\n\n`;
                     }
                }
            });
            return fullText;
        }

        document.getElementById('save-schedule-btn').addEventListener('click', () => {
             if (itemToMove) {
                 // Logic for moving an existing item
                 if (!selectedDateForScheduling) {
                     showNotification('Silakan pilih tanggal baru di kalender.', true);
                     return;
                 }
                 // Add to new date
                 if (!scheduledContent[selectedDateForScheduling]) {
                     scheduledContent[selectedDateForScheduling] = [];
                 }
                 scheduledContent[selectedDateForScheduling].push(itemToMove.item);
                 // Remove from old date
                 scheduledContent[itemToMove.originalDate].splice(itemToMove.originalIndex, 1);
                 if (scheduledContent[itemToMove.originalDate].length === 0) {
                     delete scheduledContent[itemToMove.originalDate];
                 }
                 showNotification(`Konten dipindahkan ke ${selectedDateForScheduling}!`);
                 itemToMove = null;
             } else {
                 // Logic for scheduling a new item
                 if (!selectedDateForScheduling) {
                     showNotification('Silakan pilih tanggal di kalender terlebih dahulu.', true);
                     return;
                 }
                 if (!scheduledContent[selectedDateForScheduling]) {
                     scheduledContent[selectedDateForScheduling] = [];
                 }
                 const newItem = {
                     ...currentScriptData,
                     id: Date.now(),
                     platforms: {
                         'IG': 'Siap Upload', 'FB': 'Siap Upload', 'TikTok': 'Siap Upload', 
                         'YouTube': '-', 'Shopee': '-', 'TokPed': '-'
                     }
                 };
                 scheduledContent[selectedDateForScheduling].push(newItem);
                 showNotification(`Konten berhasil dijadwalkan untuk ${selectedDateForScheduling}!`);
                 document.getElementById('scriptModal').classList.remove('visible');
             }
             
             saveScheduledContent();
             document.getElementById('calendarModal').classList.remove('visible');
             selectedDateForScheduling = null;
        });


        // Calendar View Listeners
        document.getElementById('calendar-view-btn').addEventListener('click', () => {
            calendarDate = new Date();
            renderCalendar(false); // Render in view-only mode
            document.getElementById('calendarModal').classList.add('visible');
        });

        document.getElementById('prev-month-btn').addEventListener('click', () => {
            calendarDate.setMonth(calendarDate.getMonth() - 1);
            const isScheduling = document.getElementById('calendar-actions').style.display === 'block';
            renderCalendar(isScheduling);
        });

        document.getElementById('next-month-btn').addEventListener('click', () => {
            calendarDate.setMonth(calendarDate.getMonth() + 1);
            const isScheduling = document.getElementById('calendar-actions').style.display === 'block';
            renderCalendar(isScheduling);
        });


        const scrollToTopBtn = document.getElementById('scrollToTopBtn');
        window.onscroll = function() {
            if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
                scrollToTopBtn.style.display = "flex";
            } else {
                scrollToTopBtn.style.display = "none";
            }
        };
        
        const imageUploadInput = document.getElementById('image-upload');
        const imageUploadContainer = document.getElementById('image-upload-container');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const imagePreview = document.getElementById('image-preview');
        const removeImageBtn = document.getElementById('remove-image-btn');
        const uploadLabel = imageUploadContainer.querySelector('label');

        function handleFile(file) {
            if (!file || !file.type.startsWith('image/')) {
                showNotification('Hanya file gambar yang diizinkan.', true);
                return;
            }
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.fillStyle = "#FFFFFF";
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0);
                    uploadedImageBase64 = canvas.toDataURL('image/jpeg').split(',')[1];
                    imagePreview.src = 'data:image/jpeg;base64,' + uploadedImageBase64;
                    imagePreviewContainer.classList.remove('hidden');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        imageUploadInput.addEventListener('change', (event) => handleFile(event.target.files[0]));
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadLabel.addEventListener(eventName, (e) => {
                e.preventDefault();
                e.stopPropagation();
            }, false);
        });

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadLabel.addEventListener(eventName, () => uploadLabel.classList.add('dragover'), false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadLabel.addEventListener(eventName, () => uploadLabel.classList.remove('dragover'), false);
        });

        uploadLabel.addEventListener('drop', (e) => {
            handleFile(e.dataTransfer.files[0]);
        }, false);
        
        removeImageBtn.addEventListener('click', () => {
            uploadedImageBase64 = null;
            imageUploadInput.value = ''; // Reset file input
            imagePreviewContainer.classList.add('hidden');
        });


        scrollToTopBtn.addEventListener('click', function() {
            window.scrollTo({top: 0, behavior: 'smooth'});
        });

        document.addEventListener('DOMContentLoaded', () => {
            checkLogin();

            document.getElementById('calendar-details').addEventListener('click', (e) => {
                const editBtn = e.target.closest('.edit-schedule-btn');
                const moveBtn = e.target.closest('.move-schedule-btn');
                const deleteBtn = e.target.closest('.delete-schedule-btn');
                const cancelMoveBtn = e.target.closest('#cancel-move-btn');

                if (editBtn) {
                    const { date, index } = editBtn.dataset;
                    const item = scheduledContent[date][index];
                    displayStructuredScript(item);
                    document.getElementById('calendarModal').classList.remove('visible');
                    document.getElementById('scriptModal').classList.add('visible');
                }

                if (moveBtn) {
                    const { date, index } = moveBtn.dataset;
                    const item = scheduledContent[date][index];
                    itemToMove = { item, originalDate: date, originalIndex: parseInt(index) };
                    renderCalendar(true); // Re-render in scheduling mode
                    
                    // Perubahan 3: Tambahkan tombol Batal Pindah
                    const detailsContainer = document.getElementById('calendar-details');
                    detailsContainer.innerHTML = `
                        <p class="text-yellow-300 text-center mb-4">Pilih tanggal baru untuk memindahkan konten.</p>
                        <button id="cancel-move-btn" class="w-full text-slate-300 font-bold py-2 px-4 rounded-lg bg-slate-600 hover:bg-slate-700">Batal Pindah</button>
                    `;
                }
                
                if (cancelMoveBtn) {
                    const originalDate = itemToMove.originalDate;
                    itemToMove = null;
                    renderCalendar(false);
                    showCalendarDetails(originalDate);
                    showNotification('Pemindahan jadwal dibatalkan.');
                }

                if (deleteBtn) {
                    const { date, index } = deleteBtn.dataset;
                    showDeleteConfirmation(date, index);
                }
            });

            document.getElementById('calendar-details').addEventListener('change', (e) => {
                const target = e.target;
                if (target.matches('.status-select-per-platform')) {
                    const { date, index, platform } = target.dataset;
                    const item = scheduledContent[date][index];
                    if (!item.platforms) {
                        item.platforms = {};
                    }
                    item.platforms[platform] = target.value;
                    saveScheduledContent();
                    showNotification(`Status untuk ${platform} diperbarui!`);
                }
            });
        });
    </script>
</body>
</html>
