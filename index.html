<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CONTENT CHEAT v59.1 (BYOK) © Brata Hanggara Putra</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        html { scroll-behavior: smooth; }
        body { 
            font-family: 'Inter', sans-serif;
            background-color: #0D1120;
            background-image: radial-gradient(at 27% 37%, hsla(215, 98%, 22%, 0.2) 0px, transparent 50%), radial-gradient(at 97% 21%, hsla(212, 98%, 23%, 0.2) 0px, transparent 50%), radial-gradient(at 70% 94%, hsla(282, 98%, 23%, 0.2) 0px, transparent 50%), radial-gradient(at 10% 29%, hsla(282, 98%, 23%, 0.2) 0px, transparent 50%);
            color: #E0E0E0;
        }
        .glass-effect {
            background: rgba(17, 24, 39, 0.6);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-radius: 1.5rem; border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        .modern-input, .modern-input-group, .edit-textarea {
            background-color: rgba(0, 0, 0, 0.2); border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .modern-input:focus, .edit-textarea:focus {
            outline: none; border-color: rgba(167, 139, 250, 0.8);
            box-shadow: 0 0 0 3px rgba(167, 139, 250, 0.2);
        }
        select.modern-input option { background: #0D1120; color: #E0E0E0; }
        .modern-btn {
            background: linear-gradient(90deg, #5F00D8, #A78BFA); border: none;
            transition: all 0.3s ease; box-shadow: 0 4px 15px 0 rgba(167, 139, 250, 0.4);
        }
        .modern-btn:hover {
            box-shadow: 0 6px 20px 0 rgba(167, 139, 250, 0.6); transform: translateY(-2px);
        }
        .modern-btn:disabled {
            background: #374151; box-shadow: none;
            cursor: not-allowed; transform: none;
        }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center;
            z-index: 50; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        .modal-content {
            background-color: rgba(13, 17, 32, 0.8);
            backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.1); padding: 1.5rem; border-radius: 1.5rem;
            width: 90%; max-width: 600px; transform: scale(0.95); transition: transform 0.3s;
            display: flex; flex-direction: column; max-height: 90vh;
        }
        .modal-overlay.visible .modal-content { transform: scale(1); }
        .modal-body { overflow-y: auto; padding-right: 1rem; }
        .spinner {
            width: 56px; height: 56px; border-radius: 50%; border: 9px solid;
            border-color: #A78BFA; border-right-color: #374151; animation: spinner-d3wgkg 1s infinite linear;
        }
        @keyframes spinner-d3wgkg { to { transform: rotate(1turn); } }
        .info-box {
            background: rgba(30, 41, 59, 0.5);
            border-left: 4px solid #a78bfa;
            padding: 1rem;
            border-radius: 0.5rem;
        }
        .favorite-btn.favorited .star-icon { color: #facc15; }
        .category-label {
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .category-label:hover {
            background-color: rgba(167, 139, 250, 0.3);
        }
        .pustaka-entry .efektif, .script-section .saran-shot {
            background-color: rgba(167, 139, 250, 0.1);
            color: #c4b5fd;
            padding: 2px 8px;
            border-radius: 9999px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
        }
        .hashtag {
            background-color: rgba(59, 130, 246, 0.2);
            color: #93c5fd;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .hashtag:hover {
            background-color: rgba(59, 130, 246, 0.4);
        }
        .script-edit-view {
            background-color: #1f2937;
            padding: 1rem;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Modals -->
    <div id="apiKeyModal" class="modal-overlay">
        <div class="modal-content !max-w-lg">
            <h2 class="text-2xl font-bold text-center text-white mb-4">Masukkan Kunci API Anda</h2>
            <p class="text-slate-400 text-center mb-6">Tools ini membutuhkan kunci API dari Google AI Studio untuk berfungsi. Tenang, kunci Anda aman dan hanya disimpan di browser Anda.</p>
            <input type="password" id="apiKeyInput" class="w-full rounded-lg p-3 modern-input mb-4" placeholder="Masukkan Gemini API Key di sini...">
            <button id="saveApiKeyBtn" class="w-full text-white font-bold py-3 px-6 rounded-full text-lg modern-btn mb-4">Simpan & Mulai</button>
            <div class="text-center">
                <button id="howToGetApiKeyBtn" class="text-purple-400 hover:text-purple-300 text-sm">Bagaimana caranya mendapatkan Kunci API?</button>
            </div>
        </div>
    </div>
    
    <div id="tutorialModal" class="modal-overlay">
         <div class="modal-content !max-w-2xl">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-purple-400">Cara Mudah Mendapatkan Kunci API</h2>
                <button class="close-modal-btn text-slate-400 hover:text-white text-3xl">&times;</button>
            </div>
            <div class="modal-body space-y-6 text-slate-300">
                <div>
                    <h3 class="font-bold text-lg text-slate-100">Langkah 1: Buka Google AI Studio</h3>
                    <p>Klik tombol di bawah ini. Anda mungkin akan diminta login ke akun Google (Gmail) Anda.</p>
                    <a href="https://aistudio.google.com/app/apikey" target="_blank" class="inline-block mt-2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Buka Google AI Studio</a>
                </div>
                <div>
                    <h3 class="font-bold text-lg text-slate-100">Langkah 2: Buat Kunci Baru</h3>
                    <p>Setelah halaman terbuka, klik tombol biru yang bertuliskan <strong class="text-amber-400">"Create API key in new project"</strong>.</p>
                    <img src="https://i.ibb.co/6m6Mv4T/image.png" alt="Tombol Create API Key" class="mt-2 rounded-lg border border-slate-700 w-full max-w-md" onerror="this.style.display='none'">
                </div>
                <div>
                    <h3 class="font-bold text-lg text-slate-100">Langkah 3: Salin Kunci Anda</h3>
                    <p>Sebuah pop-up akan muncul menampilkan kunci rahasia Anda. Klik ikon "salin" di sebelahnya.</p>
                    <img src="https://i.ibb.co/qN9qZ8j/image.png" alt="Pop-up dengan API key" class="mt-2 rounded-lg border border-slate-700 w-full max-w-md" onerror="this.style.display='none'">
                </div>
                <div>
                    <h3 class="font-bold text-lg text-slate-100">Selesai!</h3>
                    <p>Sekarang, kembali ke aplikasi ini dan tempel (paste) kunci yang sudah Anda salin tadi ke dalam kolom yang tersedia.</p>
                </div>
            </div>
        </div>
    </div>
    
    <div id="hookExplanationModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 id="explanation-title" class="text-2xl font-bold text-purple-400">Penjelasan Hook</h2>
                <button class="close-modal-btn text-slate-400 hover:text-white text-3xl">&times;</button>
            </div>
            <div id="explanation-body" class="modal-body text-slate-300"></div>
        </div>
    </div>

    <div id="pustakaHookModal" class="modal-overlay">
        <div class="modal-content !max-w-2xl">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-purple-400">📚 Pustaka Strategi Hook</h2>
                <button class="close-modal-btn text-slate-400 hover:text-white text-3xl">&times;</button>
            </div>
            <div id="pustaka-body" class="modal-body space-y-6 text-slate-300">
            </div>
        </div>
    </div>
    
    <div id="scriptModal" class="modal-overlay">
        <div class="modal-content !max-w-2xl">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-purple-400">✨ Kerangka Konten AI</h2>
                <button class="close-modal-btn text-slate-400 hover:text-white text-3xl">&times;</button>
            </div>
            <div id="script-result-structured" class="modal-body space-y-5">
                 <!-- Structured script will be injected here -->
            </div>
            <div class="mt-6 pt-4 border-t border-slate-700/50 flex flex-col sm:flex-row gap-3">
                <button id="copy-all-script-btn" class="flex-1 text-white font-bold py-2 px-4 rounded-lg bg-blue-600 hover:bg-blue-700 transition-colors">Salin Semua</button>
                <button id="download-doc-btn" class="flex-1 text-white font-bold py-2 px-4 rounded-lg bg-green-600 hover:bg-green-700 transition-colors">Download .doc</button>
                <button id="export-gdocs-btn" class="flex-1 text-white font-bold py-2 px-4 rounded-lg bg-yellow-600 hover:bg-yellow-700 transition-colors">Export ke GDGocs</button>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="app-container" class="container mx-auto max-w-4xl p-4 md:p-8" style="display: none;">
        <header class="text-center mb-12 relative">
            <button id="pustaka-hook-btn" title="Pustaka Hook" class="absolute top-0 right-0 p-2 text-slate-400 hover:text-purple-400 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-question-circle-fill" viewBox="0 0 16 16">
                    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.496 6.033h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286a.237.237 0 0 0 .241.247zm2.325 6.443c.61 0 1.029-.394 1.029-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94 0 .533.425.927 1.01.927z"/>
                </svg>
            </button>
            <h1 class="text-4xl md:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400">CONTENT CHEAT</h1>
            <p class="text-slate-400 mt-2 text-lg">Buat Ide Kontenmu dengan Sekali Klik</p>
            <a href="https://www.instagram.com/bratahanggaraputra/" target="_blank" class="text-purple-300 hover:text-purple-200 transition-colors mt-2 inline-block">© Brata Hanggara Putra</a>
            <p class="text-red-500 font-bold mt-2 text-sm tracking-wider">DILARANG MENJUAL KEMBALI TOOLS INI TANPA SEIZIN PENGEMBANG!</p>
            
            <div class="mt-6 info-box">
                <p class="text-slate-300">Sisa kuota generate hari ini: <strong id="quota-counter" class="text-xl text-green-400">200</strong></p>
                <p class="text-xs text-slate-500 mt-1">Kuota direset setiap hari. <button id="changeApiKey" class="text-purple-400 hover:underline">Ganti API Key</button></p>
            </div>
        </header>

        <div class="p-8 glass-effect">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                 <div>
                    <label for="topic" class="block text-sm font-medium text-slate-300 mb-2">1. Masukkan Produk / Jasa Anda <span class="text-red-400">(Wajib)</span></label>
                    <input type="text" id="topic" class="w-full rounded-lg p-3 modern-input" placeholder="Cth: Tripod, Serum Wajah">
                </div>
                <div>
                    <label for="audience" class="block text-sm font-medium text-slate-300 mb-2">2. Siapa Target Audiens Anda? <span class="text-slate-400">(Opsional)</span></label>
                    <input type="text" id="audience" class="w-full rounded-lg p-3 modern-input" placeholder="Cth: Konten Kreator, Pebisnis Online">
                </div>
                <div class="md:col-span-2">
                    <label for="details" class="block text-sm font-medium text-slate-300 mb-2">3. Detail Tambahan (Opsional)</label>
                    <input type="text" id="details" class="w-full rounded-lg p-3 modern-input" placeholder="Cth: Merk, Harga, Manfaat Utama">
                </div>
                <div>
                    <label for="hook-type" class="block text-sm font-medium text-slate-300 mb-2">4. Pilih Jenis Hasil (Opsional)</label>
                    <select id="hook-type" class="w-full rounded-lg p-3 modern-input">
                        <option value="semua">🔥 Tampilkan Semua (Direkomendasikan)</option>
                        <option value="Narasi">Narasi</option>
                        <option value="Pertanyaan">Pertanyaan</option>
                        <option value="Sebelum & Sesudah">Sebelum & Sesudah</option>
                        <option value="Social Proof">Social Proof</option>
                        <option value="Janji & Manfaat">Janji & Manfaat</option>
                        <option value="How-To">How-To</option>
                        <option value="Kontroversial">Kontroversial</option>
                        <option value="Negatif">Negatif</option>
                        <option value="FOMO">FOMO</option>
                        <option value="Penasaran">Penasaran</option>
                        <option value="Statistik">Statistik</option>
                        <option value="Kutipan">Kutipan</option>
                        <option value="Panggilan Langsung">Panggilan Langsung</option>
                    </select>
                </div>
                <div>
                    <label for="hook-count" class="block text-sm font-medium text-slate-300 mb-2">5. Jumlah Hasil (Opsional)</label>
                    <select id="hook-count" class="w-full rounded-lg p-3 modern-input">
                        <option value="5">5 Hasil</option>
                        <option value="10">10 Hasil</option>
                    </select>
                </div>
            </div>
            <div class="mt-8">
                <button id="generateBtn" class="w-full flex items-center justify-center gap-3 text-white font-bold py-4 px-6 rounded-full text-lg modern-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path></svg>
                    Generate Konten!
                </button>
            </div>
        </div>
        
        <div id="results-container" class="mt-12">
            <div id="results-header" class="flex justify-between items-center mb-4" style="display: none;">
                <h2 class="text-2xl font-bold text-slate-200">Hasil Ide Konten</h2>
                <div class="flex items-center gap-4">
                     <button id="view-favorites-btn" class="bg-yellow-500/10 text-yellow-300 font-bold py-2 px-4 rounded-lg flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16"><path d="M3.612 15.443c-.343.197-.732.026-.976-.316C2.384 14.79 2.421 14.34 2.658 14.1l.099-.101 2.56-2.528-3.797-2.61L.064 6.25c-.26-.193-.398-.5-.358-.814.04-.314.25-.583.543-.695L4.82 3.32 6.59.165c.195-.33.542-.515.91-.492.368.023.68.26.83.585l1.78 3.155 4.542 1.32c.303.088.513.368.553.68.04.313-.098.62-.358.814l-2.823 2.062 1.005 4.423c.06.264-.028.54-.25.728-.222.188-.533.243-.815.145L8 13.34l-3.267 2.007-.093.057-.003.002z"/></svg>
                        Favorit (<span id="favorite-count">0</span>)
                    </button>
                </div>
            </div>
            <div id="results-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </div>
    </div>
    
    <div id="notification" class="fixed bottom-5 right-5 bg-green-600 text-white py-3 px-5 rounded-lg shadow-lg opacity-0 transform translate-y-10 transition-all duration-500 z-50"></div>

    <script type="module">
        // --- GLOBAL STATE ---
        let userAPIKey = null;
        let lastGeneratedHooks = [];
        let favorites = [];
        let showingFavorites = false;
        let currentScriptData = null;

        const hookExplanations = {
            "Narasi": { 
                desc: "Membangun hubungan emosional dengan membagikan pengalaman pribadi (struggle & success). Sangat relateable.",
                efektif: "Personal Branding, Produk Solutif"
            },
            "Pertanyaan": {
                desc: "Memicu interaksi dan membuat audiens merefleksikan masalah mereka sendiri. Mendorong komentar.",
                efektif: "Semua Kategori"
            },
            "Sebelum & Sesudah": {
                desc: "Menunjukkan transformasi nyata untuk membuktikan efektivitas produk/jasa. Sangat visual dan meyakinkan.",
                efektif: "Produk Fisik, Jasa Skill, Kecantikan"
            },
            "Social Proof": {
                desc: "Menggunakan bukti (testimoni, angka penjualan, ulasan) bahwa banyak orang lain telah percaya pada produk/jasa Anda.",
                efektif: "Semua Kategori, terutama E-commerce"
            },
            "Janji & Manfaat": {
                desc: "Memberikan janji nilai yang jelas dan langsung di awal video. Menjawab pertanyaan 'kenapa saya harus nonton ini?'.",
                efektif: "Produk Digital, Jasa, Konten Edukasi"
            },
            "How-To": {
                desc: "Menawarkan tutorial atau cara melakukan sesuatu yang diinginkan oleh target audiens.",
                efektif: "Konten Edukasi, DIY, Skill-based"
            },
            "Kontroversial": {
                desc: "Menyatakan opini yang tidak umum atau berlawanan dengan kepercayaan populer untuk memancing perdebatan dan engagement.",
                efektif: "Personal Branding, Konten Opini"
            },
            "Negatif": {
                desc: "Menyoroti kesalahan umum atau hal-hal yang harus dihindari oleh audiens. Bermain dengan psikologi 'loss aversion'.",
                efektif: "Konten Edukasi, Nasihat Keuangan/Kesehatan"
            },
            "FOMO": {
                desc: "Fear Of Missing Out. Menciptakan urgensi atau kelangkaan, membuat audiens merasa harus bertindak sekarang.",
                efektif: "Promo Terbatas, Produk Eksklusif, Event"
            },
            "Penasaran": {
                desc: "Membuat audiens bertanya-tanya dengan memberikan potongan informasi yang tidak lengkap atau misterius.",
                efektif: "Storytelling, Product Teaser, Vlog"
            },
            "Statistik": {
                desc: "Menggunakan data, angka, atau fakta mengejutkan untuk membangun kredibilitas dan menarik perhatian.",
                efektif: "Konten Informatif, Berita, Presentasi Bisnis"
            },
            "Kutipan": {
                desc: "Memulai dengan kutipan yang kuat, relevan, atau inspiratif dari tokoh terkenal atau sumber terpercaya.",
                efektif: "Konten Motivasi, Self-development"
            },
            "Panggilan Langsung": {
                desc: "Secara langsung memanggil atau menyebut target audiens spesifik untuk membuat mereka merasa 'terpanggil'.",
                efektif: "Niche Market, Konten Komunitas"
            }
        };
        
        // --- UI UTILITIES ---
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `fixed bottom-5 right-5 text-white py-3 px-5 rounded-lg shadow-lg opacity-100 transform translate-y-0 transition-all duration-500 z-50 ${isError ? 'bg-red-600' : 'bg-green-600'}`;
            setTimeout(() => { notification.classList.replace('opacity-100', 'opacity-0'); }, 3000);
        }

        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            showNotification('Berhasil disalin ke clipboard!');
        }
        
        // --- API CALLS ---
        async function callNetlifyFunction(prompt, apiKey) {
            const response = await fetch('/.netlify/functions/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt, apiKey })
            });
            const responseBody = await response.json();
            if (!response.ok) {
                if (response.status === 400 && responseBody.error && responseBody.error.includes("API key not valid")) {
                    throw new Error("API Key tidak valid. Mohon periksa kembali atau ganti dengan yang baru.");
                }
                throw new Error(responseBody.error || `Netlify Function request failed: ${response.status}`);
            }
            return responseBody;
        }

        async function generateAIHooks(topic, audience, details, hookType, hookCount, apiKey) {
             const allCategories = Object.keys(hookExplanations).join(", ");
             const prompt = `Anda adalah seorang content strategist AI. Buat ${hookCount} hook video pendek untuk TikTok/Reels. ATURAN: 1. **WAJIB SINGKAT!** (di bawah 12 kata). 2. Gunakan bahasa Indonesia sehari-hari. 3. WAJIB relevan dengan Topik. 4. Pastikan kategori sesuai jenis hook yang diminta. Jika jenis hook "semua", buat variasi dari kategori berikut: ${allCategories}. DATA: - Topik: "${topic}" - Audiens: "${audience || 'Umum'}" - Detail Tambahan: "${details || 'Tidak ada'}" - Jenis Hook: "${hookType}". Respon HARUS berupa string array JSON valid tanpa karakter markdown (seperti \`\`\`json). Contoh format: [{"hook": "Teks hook pertama...", "category": "Narasi"}, {"hook": "Teks hook kedua...", "category": "Pertanyaan"}]`;
             const result = await callNetlifyFunction(prompt, apiKey);
             if (result.candidates?.[0]?.content?.parts?.[0]) {
                 const rawText = result.candidates[0].content.parts[0].text;
                 const cleanedText = rawText.replace(/```json/g, '').replace(/```/g, '').trim();
                 try {
                     return JSON.parse(cleanedText);
                 } catch (e) {
                     console.error("JSON Parsing Error. Raw text:", cleanedText);
                     throw new Error("Gagal memproses respons dari AI. Coba generate lagi.");
                 }
             }
             throw new Error("Struktur respons AI tidak terduga.");
        }

        async function generateAIScript(hookText, apiKey) {
            const prompt = `Anda adalah seorang AI Scriptwriter profesional. Berdasarkan hook berikut, buatlah kerangka konten video pendek (TikTok/Reels) yang lengkap dan terstruktur.

Hook: "${hookText}"
Produk/Jasa: "${document.getElementById('topic').value}"

ATURAN WAJIB:
1.  **Struktur Output**: Respons HARUS dalam format JSON yang valid dan HANYA JSON. Tidak boleh ada teks atau markdown lain di luar JSON.
2.  **Konten JSON**: JSON harus memiliki kunci-kunci berikut: "saran_audio", "hook_scene", "masalah", "solusi", "cta", "caption", dan "hashtags".
3.  **Detail Setiap Bagian**: Untuk "hook_scene", "masalah", "solusi", dan "cta", masing-masing harus berupa objek yang berisi: "durasi" (string, cth: "0-5"), "estimasi" (integer, cth: 5), "visual" (string), "narasi" (string), dan "saran_shot" (string).
4.  **Konten Lain**: "saran_audio" harus array string. "caption" harus string. "hashtags" harus array string.
5.  **Bahasa**: Gunakan bahasa Indonesia yang kasual dan menarik.

Contoh struktur JSON yang diharapkan:
{
  "saran_audio": ["'Espresso' - Sabrina Carpenter", "Suara viral lainnya"],
  "hook_scene": { "durasi": "0-5", "estimasi": 5, "visual": "Video goyang sebelum pakai tripod, lalu stabil setelahnya.", "narasi": "Video stabil? Tripod ini jawabannya!", "saran_shot": "Side-by-side comparison" },
  "masalah": { "durasi": "5-10", "estimasi": 5, "visual": "Close-up video yang goyang, memperlihatkan kesulitan merekam.", "narasi": "Capek video goyang terus? Bikin pusing yang nonton!", "saran_shot": "Close-up" },
  "solusi": { "durasi": "10-17", "estimasi": 7, "visual": "Demonstrasi penggunaan tripod dalam berbagai situasi.", "narasi": "Nih, kenalan sama tripod andalan! Ringan, kuat, fleksibel!", "saran_shot": "360 degree view" },
  "cta": { "durasi": "17-20", "estimasi": 3, "visual": "Tampilan layar dengan teks 'Beli Sekarang' dan link ke toko.", "narasi": "Langsung checkout sekarang! Stok terbatas!", "saran_shot": "Close-up" },
  "caption": "Gak ada lagi video goyang! Tripod ini solusi konten stabilmu.",
  "hashtags": ["#tripod", "#videostabil", "#kontenkreator"]
}`;
            const result = await callNetlifyFunction(prompt, apiKey);
            if (result.candidates?.[0]?.content?.parts?.[0]) {
                 const rawText = result.candidates[0].content.parts[0].text;
                 const cleanedText = rawText.replace(/```json/g, '').replace(/```/g, '').trim();
                 try {
                     return JSON.parse(cleanedText);
                 } catch (e) {
                     console.error("JSON Parsing Error for script. Raw text:", cleanedText);
                     throw new Error("Gagal memproses kerangka konten dari AI.");
                 }
             }
             throw new Error("Struktur respons kerangka konten tidak terduga.");
        }
        
        // --- DISPLAY LOGIC ---
        function displayHooks(hooksToDisplay) {
            const resultsGrid = document.getElementById('results-grid');
            const resultsHeader = document.getElementById('results-header');
            resultsGrid.innerHTML = '';
            resultsHeader.style.display = 'flex';

            if (hooksToDisplay.length === 0) {
                 resultsGrid.innerHTML = `<div class="md:col-span-2 text-center text-slate-400 py-8">
                    ${showingFavorites ? 'Anda belum punya favorit. Tandai dengan ikon bintang!' : 'Generate ide untuk melihat hasilnya di sini.'}
                 </div>`;
                 return;
            }

            hooksToDisplay.forEach(hookData => {
                 const isFavorited = favorites.some(fav => fav.hook === hookData.hook);
                 const card = document.createElement('div');
                 card.className = 'bg-slate-800/20 p-5 rounded-xl fade-in flex flex-col justify-between';
                 card.innerHTML = `
                    <div>
                        <p class="text-slate-200 text-lg">${hookData.hook}</p>
                    </div>
                    <div class="flex justify-between items-center mt-4">
                        <button class="category-label inline-block bg-purple-500/20 text-purple-300 text-xs font-semibold px-2 py-1 rounded-full" data-category="${hookData.category}">${hookData.category}</button>
                        <div class="flex items-center gap-2">
                             <button class="generate-script-btn bg-blue-500/20 text-blue-300 text-xs font-bold px-3 py-1 rounded-full" data-hook="${hookData.hook}">Buat Script</button>
                             <button class="favorite-btn p-1 text-slate-400 hover:text-yellow-400 transition-colors ${isFavorited ? 'favorited' : ''}" data-hook="${hookData.hook}" data-category="${hookData.category}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-star-fill star-icon" viewBox="0 0 16 16"><path d="M3.612 15.443c-.343.197-.732.026-.976-.316C2.384 14.79 2.421 14.34 2.658 14.1l.099-.101 2.56-2.528-3.797-2.61L.064 6.25c-.26-.193-.398-.5-.358-.814.04-.314.25-.583.543-.695L4.82 3.32 6.59.165c.195-.33.542-.515.91-.492.368.023.68.26.83.585l1.78 3.155 4.542 1.32c.303.088.513.368.553.68.04.313-.098.62-.358.814l-2.823 2.062 1.005 4.423c.06.264-.028.54-.25.728-.222.188-.533.243-.815.145L8 13.34l-3.267 2.007-.093.057-.003.002z"/></svg>
                             </button>
                        </div>
                    </div>
                 `;
                 resultsGrid.appendChild(card);
            });
        }
        
        function displayStructuredScript(data) {
            const container = document.getElementById('script-result-structured');
            currentScriptData = data;
            container.innerHTML = ''; 

            const sectionIcons = { saran_audio: '🎵', hook_scene: '🎬', masalah: '😟', solusi: '💡', cta: '🚀', caption: '✍️', hashtags: '#️⃣' };
            const sectionTitles = { saran_audio: 'Saran Audio Trending', hook_scene: 'Hook (Scene)', masalah: 'Masalah', solusi: 'Solusi', cta: 'CTA', caption: 'Caption', hashtags: 'Hashtags' };
            const sectionOrder = ["saran_audio", "hook_scene", "masalah", "solusi", "cta", "caption", "hashtags"];

            sectionOrder.forEach(key => {
                if (!data[key]) return;

                const sectionWrapper = document.createElement('div');
                sectionWrapper.className = 'script-section-wrapper';
                sectionWrapper.dataset.sectionKey = key;

                let displayHTML = '';
                let editHTML = '';

                // --- Build Display and Edit HTML ---
                if (key === 'saran_audio' || key === 'hashtags') {
                    const content = Array.isArray(data[key]) ? data[key].join(', ') : data[key];
                    const tagsHTML = key === 'hashtags' ? data[key].map(tag => `<span class="hashtag">${tag}</span>`).join(' ') : `<p class="text-slate-300">${content}</p>`;
                    displayHTML = `<div class="pl-7">${key === 'hashtags' ? `<div class="flex flex-wrap gap-2">${tagsHTML}</div>` : tagsHTML}</div>`;
                    editHTML = `<textarea class="w-full h-24 p-2 rounded-md edit-textarea">${content}</textarea>`;
                } else if (key === 'caption') {
                    displayHTML = `<div class="pl-7"><p class="text-slate-300">${data[key]}</p></div>`;
                    editHTML = `<textarea class="w-full h-24 p-2 rounded-md edit-textarea">${data[key]}</textarea>`;
                } else if (typeof data[key] === 'object' && data[key] !== null) {
                    const item = data[key];
                    displayHTML = `
                        <div class="pl-7">
                            <p class="text-sm text-slate-400 mb-2">🕒 Detik ${item.durasi || ''} (Estimasi: ${item.estimasi || '?'} detik)</p>
                            <p><strong class="text-slate-100">VISUAL:</strong> ${item.visual || ''}</p>
                            <p><strong class="text-slate-100">NARASI:</strong> ${item.narasi || ''}</p>
                            <p class="mt-2"><span class="saran-shot">Saran Shot: ${item.saran_shot || ''}</span></p>
                        </div>`;
                    editHTML = `
                        <div class="space-y-2">
                            <label class="block text-xs text-slate-400">Visual</label>
                            <textarea class="w-full h-20 p-2 rounded-md edit-textarea" data-field="visual">${item.visual || ''}</textarea>
                            <label class="block text-xs text-slate-400">Narasi</label>
                            <textarea class="w-full h-20 p-2 rounded-md edit-textarea" data-field="narasi">${item.narasi || ''}</textarea>
                        </div>`;
                }

                sectionWrapper.innerHTML = `
                    <div class="script-section-display">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-xl font-bold text-slate-100">${sectionIcons[key]} ${sectionTitles[key]}</h3>
                            <div class="flex items-center gap-2">
                                <button class="edit-section-btn p-1 text-slate-400 hover:text-white" title="Edit bagian ini">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16"><path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/><path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/></svg>
                                </button>
                                <button class="copy-section-btn p-1 text-slate-400 hover:text-white" title="Salin bagian ini">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3z"/></svg>
                                </button>
                            </div>
                        </div>
                        ${displayHTML}
                    </div>
                    <div class="script-edit-view hidden">
                         <h3 class="text-xl font-bold text-slate-100 mb-4">${sectionIcons[key]} Edit ${sectionTitles[key]}</h3>
                         ${editHTML}
                         <div class="flex gap-3 mt-4">
                            <button class="save-edit-btn flex-1 text-white font-bold py-2 px-4 rounded-lg bg-green-600 hover:bg-green-700 transition-colors">Simpan</button>
                            <button class="cancel-edit-btn flex-1 text-slate-300 font-bold py-2 px-4 rounded-lg bg-slate-600 hover:bg-slate-700 transition-colors">Batal</button>
                         </div>
                    </div>
                `;
                container.appendChild(sectionWrapper);
            });
        }
        
        
        // --- FAVORITES LOGIC ---
        function toggleFavorite(hookData) {
            const index = favorites.findIndex(fav => fav.hook === hookData.hook);
            if (index > -1) {
                favorites.splice(index, 1);
                showNotification('Dihapus dari favorit!', false);
            } else {
                favorites.push(hookData);
                showNotification('Ditambahkan ke favorit!', false);
            }
            saveFavorites();
            updateFavoriteCount();
            displayHooks(showingFavorites ? favorites : lastGeneratedHooks);
        }
        function saveFavorites() { localStorage.setItem('contentCheatFavorites', JSON.stringify(favorites)); }
        function loadFavorites() {
            favorites = JSON.parse(localStorage.getItem('contentCheatFavorites')) || [];
            updateFavoriteCount();
        }
        function updateFavoriteCount() { document.getElementById('favorite-count').textContent = favorites.length; }

        // --- MODAL & EXPLANATION LOGIC ---
        function showHookExplanation(category) {
            const modal = document.getElementById('hookExplanationModal');
            const explanationData = hookExplanations[category];
            if (explanationData) {
                document.getElementById('explanation-title').textContent = `Strategi Hook: ${category}`;
                document.getElementById('explanation-body').innerHTML = `
                    <p>${explanationData.desc}</p>
                    <p class="mt-4"><span class="efektif">Efektif untuk:</span> ${explanationData.efektif}</p>
                `;
                modal.classList.add('visible');
            }
        }
        
        function populatePustaka() {
            const container = document.getElementById('pustaka-body');
            container.innerHTML = '';
            for (const [title, data] of Object.entries(hookExplanations)) {
                const entry = document.createElement('div');
                entry.className = 'pustaka-entry';
                entry.innerHTML = `
                    <h3 class="font-bold text-lg text-slate-100">${title}</h3>
                    <p class="mt-1">${data.desc}</p>
                    <p class="mt-2"><span class="efektif">Efektif untuk:</span> ${data.efektif}</p>
                `;
                container.appendChild(entry);
            }
        }
        
        // --- QUOTA MANAGEMENT ---
        const quotaManager = {
            getQuotaData: () => JSON.parse(localStorage.getItem('userQuotaData')) || { quotaLeft: 200, lastReset: '' },
            saveQuotaData: (data) => localStorage.setItem('userQuotaData', JSON.stringify(data)),
            checkAndResetQuota: function() {
                const today = new Date().toISOString().split('T')[0];
                let data = this.getQuotaData();
                if (data.lastReset !== today) {
                    data.quotaLeft = 200;
                    data.lastReset = today;
                    this.saveQuotaData(data);
                }
                this.updateDisplay(data.quotaLeft);
            },
            decrementQuota: function() {
                let data = this.getQuotaData();
                if (data.quotaLeft > 0) {
                    data.quotaLeft -= 1;
                    this.saveQuotaData(data);
                    this.updateDisplay(data.quotaLeft);
                }
            },
            updateDisplay: function(quota) {
                const counterEl = document.getElementById('quota-counter');
                if(counterEl) {
                    counterEl.textContent = quota;
                    counterEl.classList.toggle('text-red-400', quota < 20);
                    counterEl.classList.toggle('text-green-400', quota >= 20);
                }
                document.getElementById('generateBtn').disabled = quota <= 0;
            }
        };

        // --- APP INITIALIZATION & EVENT LISTENERS ---
        function initializeApp() {
            const storedApiKey = localStorage.getItem('userGeminiApiKey');
            const appContainer = document.getElementById('app-container');
            const apiKeyModal = document.getElementById('apiKeyModal');
            
            if (storedApiKey) {
                userAPIKey = storedApiKey;
                appContainer.style.display = 'block';
                apiKeyModal.classList.remove('visible');
                quotaManager.checkAndResetQuota();
                loadFavorites();
                populatePustaka();
            } else {
                appContainer.style.display = 'none';
                apiKeyModal.classList.add('visible');
            }
        }
        
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    const modalId = overlay.id;
                    overlay.classList.remove('visible');
                    const hasApiKey = !!localStorage.getItem('userGeminiApiKey');
                    if (modalId === 'apiKeyModal' && !hasApiKey) {
                        setTimeout(() => initializeApp(), 50);
                    }
                }
            });
        });

        document.querySelectorAll('.close-modal-btn').forEach(btn => {
             btn.addEventListener('click', () => { btn.closest('.modal-overlay').classList.remove('visible'); });
        });
        
        document.getElementById('saveApiKeyBtn').addEventListener('click', () => {
            const apiKeyInput = document.getElementById('apiKeyInput').value.trim();
            if (apiKeyInput) {
                localStorage.setItem('userGeminiApiKey', apiKeyInput);
                initializeApp();
                showNotification('API Key berhasil disimpan!', false);
            } else {
                showNotification('Mohon masukkan API Key.', true);
            }
        });
        
        document.getElementById('changeApiKey').addEventListener('click', () => {
            localStorage.removeItem('userGeminiApiKey');
            localStorage.removeItem('userQuotaData');
            initializeApp();
        });

        document.getElementById('howToGetApiKeyBtn').addEventListener('click', () => { document.getElementById('tutorialModal').classList.add('visible'); });
        document.getElementById('pustaka-hook-btn').addEventListener('click', () => { document.getElementById('pustakaHookModal').classList.add('visible'); });

        // Main Generate Button
        document.getElementById('generateBtn').addEventListener('click', async () => {
            if (quotaManager.getQuotaData().quotaLeft <= 0) {
                showNotification('Maaf, kuota generate harian Anda sudah habis.', true); return;
            }
            const topic = document.getElementById('topic').value.trim();
            if (!topic) {
                showNotification('Mohon isi Produk / Jasa Anda terlebih dahulu.', true); return;
            }
            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<div class="spinner !w-6 !h-6 !border-4"></div><span>Generating...</span>';
            
            try {
                const hooks = await generateAIHooks(topic, document.getElementById('audience').value.trim(), document.getElementById('details').value.trim(), document.getElementById('hook-type').value, document.getElementById('hook-count').value, userAPIKey);
                quotaManager.decrementQuota();
                lastGeneratedHooks = hooks;
                showingFavorites = false;
                document.getElementById('view-favorites-btn').innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16"><path d="M3.612 15.443c-.343.197-.732.026-.976-.316C2.384 14.79 2.421 14.34 2.658 14.1l.099-.101 2.56-2.528-3.797-2.61L.064 6.25c-.26-.193-.398-.5-.358-.814.04-.314.25-.583.543-.695L4.82 3.32 6.59.165c.195-.33.542-.515.91-.492.368.023.68.26.83.585l1.78 3.155 4.542 1.32c.303.088.513.368.553.68.04.313-.098.62-.358.814l-2.823 2.062 1.005 4.423c.06.264-.028.54-.25.728-.222.188-.533.243-.815.145L8 13.34l-3.267 2.007-.093.057-.003.002z"/></svg>Favorit (<span id="favorite-count">${favorites.length}</span>)`;
                displayHooks(lastGeneratedHooks);
            } catch (error) {
                console.error('AI Generation Error:', error);
                showNotification(error.message, true);
                if (error.message.includes("API Key tidak valid")) {
                    localStorage.removeItem('userGeminiApiKey');
                    initializeApp();
                }
            }
            generateBtn.disabled = quotaManager.getQuotaData().quotaLeft <= 0;
            generateBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path></svg> Generate Konten!';
        });

        document.getElementById('view-favorites-btn').addEventListener('click', () => {
            showingFavorites = !showingFavorites;
            const btn = document.getElementById('view-favorites-btn');
            if (showingFavorites) {
                displayHooks(favorites);
                btn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left-circle-fill" viewBox="0 0 16 16"><path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zm3.5 7.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z"/></svg>Kembali ke Hasil`;
            } else {
                displayHooks(lastGeneratedHooks);
                btn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16"><path d="M3.612 15.443c-.343.197-.732.026-.976-.316C2.384 14.79 2.421 14.34 2.658 14.1l.099-.101 2.56-2.528-3.797-2.61L.064 6.25c-.26-.193-.398-.5-.358-.814.04-.314.25-.583.543-.695L4.82 3.32 6.59.165c.195-.33.542-.515.91-.492.368.023.68.26.83.585l1.78 3.155 4.542 1.32c.303.088.513.368.553.68.04.313-.098.62-.358.814l-2.823 2.062 1.005 4.423c.06.264-.028.54-.25.728-.222.188-.533.243-.815.145L8 13.34l-3.267 2.007-.093.057-.003.002z"/></svg>Favorit (<span id="favorite-count">${favorites.length}</span>)`;
            }
        });

        // Event Delegation for dynamic cards
        document.getElementById('results-grid').addEventListener('click', async (e) => {
            const favoriteBtn = e.target.closest('.favorite-btn');
            const scriptBtn = e.target.closest('.generate-script-btn');
            const categoryLabel = e.target.closest('.category-label');

            if (favoriteBtn) {
                toggleFavorite({ hook: favoriteBtn.dataset.hook, category: favoriteBtn.dataset.category });
            }
            if (categoryLabel) {
                showHookExplanation(categoryLabel.dataset.category);
            }
            if (scriptBtn) {
                const hookText = scriptBtn.dataset.hook;
                const modal = document.getElementById('scriptModal');
                const resultContainer = document.getElementById('script-result-structured');
                resultContainer.innerHTML = '<div class="flex justify-center items-center h-full"><div class="spinner !w-10 !h-10 !border-4"></div></div>';
                modal.classList.add('visible');
                
                try {
                    const scriptData = await generateAIScript(hookText, userAPIKey);
                    displayStructuredScript(scriptData);
                } catch (error) {
                    resultContainer.innerHTML = `<p class="text-red-400 text-center">Gagal membuat kerangka konten: ${error.message}</p>`;
                }
            }
        });

        // Script Modal Buttons
        document.getElementById('script-result-structured').addEventListener('click', e => {
            const wrapper = e.target.closest('.script-section-wrapper');
            if (!wrapper) return;
            const sectionKey = wrapper.dataset.sectionKey;
            
            const editBtn = e.target.closest('.edit-section-btn');
            const saveBtn = e.target.closest('.save-edit-btn');
            const cancelBtn = e.target.closest('.cancel-edit-btn');
            const copyBtn = e.target.closest('.copy-section-btn');

            const displayView = wrapper.querySelector('.script-section-display');
            const editView = wrapper.querySelector('.script-edit-view');

            if(editBtn) {
                displayView.classList.add('hidden');
                editView.classList.remove('hidden');
            }
            if(cancelBtn) {
                displayView.classList.remove('hidden');
                editView.classList.add('hidden');
                showNotification('Perubahan dibatalkan');
            }
            if(saveBtn) {
                // Save logic
                const sectionData = currentScriptData[sectionKey];
                if (typeof sectionData === 'object' && sectionData !== null && !Array.isArray(sectionData)) {
                    editView.querySelectorAll('textarea').forEach(area => {
                       currentScriptData[sectionKey][area.dataset.field] = area.value;
                    });
                } else {
                     const mainTextarea = editView.querySelector('textarea');
                      if (Array.isArray(sectionData)) {
                         currentScriptData[sectionKey] = mainTextarea.value.split(',').map(item => item.trim());
                      } else {
                         currentScriptData[sectionKey] = mainTextarea.value;
                      }
                }
                displayStructuredScript(currentScriptData);
                showNotification('Perubahan berhasil disimpan!', false);
            }
            if (copyBtn) {
                const sectionData = currentScriptData[sectionKey];
                let textToCopy = '';
                if (typeof sectionData === 'string') {
                    textToCopy = sectionData;
                } else if (Array.isArray(sectionData)) {
                    textToCopy = sectionData.join(', ');
                } else if (typeof sectionData === 'object' && sectionData !== null) {
                    textToCopy = `VISUAL: ${sectionData.visual}\nNARASI: ${sectionData.narasi}`;
                }
                copyToClipboard(textToCopy);
            }
        });

        document.getElementById('copy-all-script-btn').addEventListener('click', () => {
            if (!currentScriptData) return;
            let fullText = "✨ Kerangka Konten AI ✨\n\n";
            const sectionTitles = { saran_audio: 'Saran Audio Trending', hook_scene: 'Hook (Scene)', masalah: 'Masalah', solusi: 'Solusi', cta: 'CTA', caption: 'Caption', hashtags: 'Hashtags' };
            for(const key in sectionTitles) {
                if(currentScriptData[key]) {
                    fullText += `--- ${sectionTitles[key].toUpperCase()} ---\n`;
                     const data = currentScriptData[key];
                     if (typeof data === 'string') {
                        fullText += data + '\n\n';
                    } else if (Array.isArray(data)) {
                        fullText += data.join(', ') + '\n\n';
                    } else if (typeof data === 'object') {
                        fullText += `Durasi: Detik ${data.durasi}\nVisual: ${data.visual}\nNarasi: ${data.narasi}\nSaran Shot: ${data.saran_shot}\n\n`;
                    }
                }
            }
            copyToClipboard(fullText);
        });

        document.getElementById('download-doc-btn').addEventListener('click', () => {
            if (!currentScriptData) return;
            let content = `<h1>Kerangka Konten AI</h1>`;
            const sectionTitles = { saran_audio: 'Saran Audio Trending', hook_scene: 'Hook (Scene)', masalah: 'Masalah', solusi: 'Solusi', cta: 'CTA', caption: 'Caption', hashtags: 'Hashtags' };
            for(const key in sectionTitles) {
                if(currentScriptData[key]) {
                    content += `<h2>${sectionTitles[key]}</h2>`;
                    const data = currentScriptData[key];
                    if (typeof data === 'string') content += `<p>${data}</p>`;
                    else if (Array.isArray(data)) content += `<p>${data.join(', ')}</p>`;
                    else if (typeof data === 'object') content += `<p><b>Durasi:</b> Detik ${data.durasi}<br/><b>Visual:</b> ${data.visual}<br/><b>Narasi:</b> ${data.narasi}<br/><b>Saran Shot:</b> ${data.saran_shot}</p>`;
                }
            }
            const blob = new Blob(['<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40"><head><meta charset="utf-8"><title>Kerangka Konten</title></head><body>' + content + '</body></html>'], {type: 'application/msword'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'kerangka-konten.doc';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });

        document.getElementById('export-gdocs-btn').addEventListener('click', () => {
             showNotification('Fitur ini sedang dalam pengembangan.', true);
        });


        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
